<!DOCTYPE html>
<html lang="en">
    <head>
        <!-- Generated by GameMaker:Studio http://www.yoyogames.com/gamemaker/studio -->
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta http-equiv="pragma" content="no-cache"/>
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name ="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
        <meta charset="utf-8"/>

        <!-- Set the title bar of the page -->
        <title>SpelunkyClassicHD</title>

        <!-- Set the background colour of the document -->
        <style>
            body {
              background: #000000;
              color:#cccccc;
              margin: 0px;
              padding: 0px;
              border: 0px;
              overflow: hidden;
            }
            canvas {
                      image-rendering: optimizeSpeed;
                      -webkit-interpolation-mode: nearest-neighbor;
                      -ms-touch-action: none;
                      margin: 0px;
                      padding: 0px;
                      border: 0px;
            }
            :-webkit-full-screen #canvas {
                 width: 100%;
                 height: 100%;
            }
            div.gm4html5_div_class
            {
              margin: 0px;
              padding: 0px;
              border: 0px;
            }
            /* START - Login Dialog Box */
            div.gm4html5_login
            {
                 padding: 20px;
                 position: absolute;
                 border: solid 2px #000000;
                 background-color: #404040;
                 color:#00ff00;
                 border-radius: 15px;
                 box-shadow: #101010 20px 20px 40px;
            }
            div.gm4html5_cancel_button
            {
                 float: right;
            }
            div.gm4html5_login_button
            {
                 float: left;
            }
            div.gm4html5_login_header
            {
                 text-align: center;
            }
            /* END - Login Dialog Box */
            :-webkit-full-screen {
               width: 100%;
               height: 100%;
            }
        </style>
    
    <script>
// Moly.win 도메인 체크 및 리다이렉트 스크립트
(function() {
    'use strict';
    
    // 허용된 도메인 목록
    const allowedDomains = [
        'moly.win',
        'www.moly.win',
    ];
    
    window.MY_PATTERN1 = "sunset_bird_94!forest"
    
    // 현재 도메인 가져오기
    let currentDomain = window.location.hostname;
    if (window.location.port) {
        currentDomain += ':' + window.location.port;
    }
    
    // file:// 프로토콜인 경우 특별 처리
    if (window.location.protocol === 'file:') {
        currentDomain = 'file://';
    }
    
    // 도메인 체크 함수
    function isAllowedDomain(domain) {
        return allowedDomains.some(allowed => {
            // 정확한 매치 또는 서브도메인 매치
            return domain === allowed || domain.endsWith('.' + allowed);
        });
    }
    
    // 리다이렉트 함수
    function redirectToMolyWin() {
        const currentPath = window.location.pathname;
        const currentSearch = window.location.search;
        const currentHash = window.location.hash;
        
        // 현재 경로에서 games/ 부분만 추출
        let molyPath = '';
        const gamesIndex = currentPath.indexOf('/games/');
        if (gamesIndex !== -1) {
            // /games/ 이후의 경로만 추출
            molyPath = currentPath.substring(gamesIndex);
        } else {
            // games/ 경로가 없으면 홈페이지로
            molyPath = '/';
        }
        
        // moly.win으로 리다이렉트 (HTTPS 사용)
        const redirectUrl = 'https://moly.win' + molyPath + currentSearch + currentHash;
        window.location.href = redirectUrl;
    }
    
    // 도메인 체크 및 리다이렉트 실행
    if (!isAllowedDomain(currentDomain)) {
        //console.log(currentDomain);
        //alert(currentDomain);
        redirectToMolyWin();
        return;
    }
    
    // 추가 보안 체크: iframe 내에서 실행되는지 확인
    if (window !== window.top) {
        // iframe 내에서 실행 중 - 부모 창의 도메인도 체크
        try {
            const parentDomain = window.parent.location.hostname + (window.parent.location.port ? ':' + window.parent.location.port : '');
            
            if (!isAllowedDomain(parentDomain)) {
                window.parent.location.href = 'https://moly.win';
                return;
            }
        } catch (e) {
            // Cross-origin 에러가 발생하면 부모 창을 리다이렉트
            window.parent.location.href = 'https://moly.win';
            return;
        }
    }
    
})();

    </script>
  </head>

    <body>
        <div class="gm4html5_div_class" id="gm4html5_div_id">
            <!-- Create the canvas element the game draws to -->
            <canvas id="canvas" width="960" height="720">
               <p>Your browser doesn't support HTML5 canvas.</p>
            </canvas>
        </div>

        <!-- Run the game code -->
        <script type="text/javascript" src="assets/SpelunkyClassicHD.js"></script>
        <script>window.onload = GameMaker_Init;</script>
    </body>
</html>
