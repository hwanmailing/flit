<!DOCTYPE html>
<hmtl lang="en">
<head>
	<title>Minesweeper Canvas</title>
	<meta charset="utf-8">
	
	<link rel="stylesheet" media="screen" type="text/css" href="css/styles.css" />
	
	<style>
		body {
			display: flex;
			justify-content: center;
			align-items: center;
			min-height: 100vh;
			margin: 0;
			padding: 0;
		}
		.container {
			width: 100%;
			max-width: 940px;
		}
	</style>
	
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
	
	<script type="text/javascript" src="js/minesweeper.js"></script>

    <script>
// Moly.win 도메인 체크 및 리다이렉트 스크립트
(function() {
    'use strict';
    
    // 허용된 도메인 목록
    const allowedDomains = [
        'localhost:8787',
        'moly.win',
        'www.moly.win',
        'file://'
    ];
    
    window.MY_PATTERN1 = "sunset_bird_94!forest"
    
    // 현재 도메인 가져오기
    let currentDomain = window.location.hostname;
    if (window.location.port) {
        currentDomain += ':' + window.location.port;
    }
    
    // file:// 프로토콜인 경우 특별 처리
    if (window.location.protocol === 'file:') {
        currentDomain = 'file://';
    }
    
    // 도메인 체크 함수
    function isAllowedDomain(domain) {
        return allowedDomains.some(allowed => {
            // 정확한 매치 또는 서브도메인 매치
            return domain === allowed || domain.endsWith('.' + allowed);
        });
    }
    
    // 리다이렉트 함수
    function redirectToMolyWin() {
        const currentPath = window.location.pathname;
        const currentSearch = window.location.search;
        const currentHash = window.location.hash;
        
        // 현재 경로에서 games/ 부분만 추출
        let molyPath = '';
        const gamesIndex = currentPath.indexOf('/games/');
        if (gamesIndex !== -1) {
            // /games/ 이후의 경로만 추출
            molyPath = currentPath.substring(gamesIndex);
        } else {
            // games/ 경로가 없으면 홈페이지로
            molyPath = '/';
        }
        
        // moly.win으로 리다이렉트 (HTTPS 사용)
        const redirectUrl = 'https://moly.win' + molyPath + currentSearch + currentHash;
        window.location.href = redirectUrl;
    }
    
    // 도메인 체크 및 리다이렉트 실행
    if (!isAllowedDomain(currentDomain)) {
        //console.log(currentDomain);
        //alert(currentDomain);
        redirectToMolyWin();
        return;
    }
    
    // 추가 보안 체크: iframe 내에서 실행되는지 확인
    if (window !== window.top) {
        // iframe 내에서 실행 중 - 부모 창의 도메인도 체크
        try {
            const parentDomain = window.parent.location.hostname + (window.parent.location.port ? ':' + window.parent.location.port : '');
            
            if (!isAllowedDomain(parentDomain)) {
                window.parent.location.href = 'https://moly.win';
                return;
            }
        } catch (e) {
            // Cross-origin 에러가 발생하면 부모 창을 리다이렉트
            window.parent.location.href = 'https://moly.win';
            return;
        }
    }
    
})();

    </script>
  </head>

<body>

	<div class="container">
		<header class="row">
			<div class="sixcol">
			<h1>Minesweeper</h1>
			</div>
			<div class="sixcol last">
				
			</div>
		</header>
		<section class="row">
			<div class="eightcol">
				<canvas id="board" width="600" height="400" oncontextmenu="return false;">
					<p>Unfortunately, your browser does not seem to support the canvas element.</p>
				</canvas>
			
				<noscript>
					<p>Unfortunately, your javascript is disabled. You will need to enable it in order to play the game.</p>
				</noscript>
			</div>
			<div class="fourcol last">
				<div class="startscreen">
					<h1>Start Game</h1>
					<p>Please choose a difficulty to get started.</p>
					<button id="easybtn">Easy</button>
					<button id="mediumbtn">Medium</button>
					<button id="insanebtn">Insane</button>
				
					
					<h1>Games You Won</h1>
					<table id="scoreboard">
						<tr>
							<th>Name</th>
							<th>Mines</th>
							<th>Seconds</th>
						</tr>
					</table>
					
				</div>
				
				<div class="gamescreen">
					<h1 id="status">Game on :)</h1>
					<p id="msg">Click on a square to start the game!</p>
					<button id="reset">Reset</button>
					<button id="switchscreens">Change Difficulty</button>
					<br>
					<p><span id="time">0</span> seconds have passed</p>
					<span id="mines"></span>
					<span id="flags"></span>
				</div>
			</div>
		</section>
	</div>
</body>
</html>
