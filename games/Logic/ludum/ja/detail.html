<!DOCTYPE html><html lang="ja"><head><script data-build-flag="is-test-mode">
const isTestMode = false;
const API_BASE_URL = "https://molyserver.by4bit.workers.dev";
const AVAILABLE_LANGS = ["en","ko","ja"];
const CURRENT_LANG = "ja";
const ROOT_PATH = "https://www.moly.win";
window.isTestMode = isTestMode;
window.API_BASE_URL = API_BASE_URL;
window.AVAILABLE_LANGS = AVAILABLE_LANGS;
window.CURRENT_LANG = CURRENT_LANG;
window.ROOT_PATH = ROOT_PATH;
</script><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Ludum - Moly.win</title><meta name="description" content="A classic arcade-style shooter where the player controls a spaceship and must defeat waves of incoming aliens."><meta name="keywords" content="Logic, ÌîåÎûòÏãúÍ≤åÏûÑ, Ludum"><link rel="icon" type="image/jpeg" href="https://www.moly.win/icon.webp"><meta property="og:title" content="Ludum - Moly.win"><meta property="og:description" content="A classic arcade-style shooter where the player controls a spaceship and must defeat waves of incoming aliens."><meta property="og:image" content="thumbnail.jpg"><meta property="og:type" content="website"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="Ludum - Moly.win"><meta name="twitter:description" content="A classic arcade-style shooter where the player controls a spaceship and must defeat waves of incoming aliens."><meta name="twitter:image" content="thumbnail.jpg"><style>*{margin:0;padding:0;box-sizing:border-box;scrollbar-color:#a64a1f #f7bd36}::-webkit-scrollbar{width:12px}::-webkit-scrollbar-track{background:#f7bd36}::-webkit-scrollbar-thumb{background:#a64a1f;border-radius:6px}::-webkit-scrollbar-thumb:hover{background:#a64a1f}body{background:#f7bd36;min-height:100vh;display:grid;grid-template-columns:1fr;grid-template-rows:60px auto;grid-template-areas:"topbar" "content"}.container{grid-area:content;display:flex;flex-direction:row;overflow:hidden;min-height:0}.game-title{font-size:1rem;color:#333;margin-bottom:10px}.game-category{background:#000;color:#f7bd36;padding:8px 20px;border-radius:25px;display:inline-block;font-size:1rem;font-weight:500}.main-content{display:flex;flex:1;gap:10px;margin:10px;min-height:0}.game-info-tab{padding:10px 20px;background:0 0;border:none;border-bottom:3px solid transparent;cursor:pointer;font-size:1rem;font-weight:500;color:#666;transition:.3s;position:relative;top:2px}.game-info-tab:hover{color:#000;background:rgba(0,0,0,.05)}.game-info-tab.active{color:#000;border-bottom-color:#a64a1f;font-weight:700}.game-info-tab-content{display:none;flex:1;overflow-y:auto}.game-info-tab-content.active{display:block}.comments-container{display:flex;flex-direction:column;gap:15px}.comment-item{background:#fff;padding:15px;border-radius:10px;border-left:4px solid #a64a1f;box-shadow:0 2px 5px rgba(0,0,0,.1)}.comment-header{display:flex;align-items:center;gap:10px;margin-bottom:10px}.comment-avatar{width:40px;height:40px;border-radius:50%;object-fit:cover;border:2px solid #a64a1f}.comment-user{flex:1}.comment-nickname{font-weight:600;color:#000;font-size:.95rem}.comment-date{font-size:.85rem;color:#666}.comment-content{color:#333;line-height:1.5;white-space:pre-wrap;word-wrap:break-word}.comments-empty{text-align:center;padding:40px 20px;color:#666;font-size:1rem}.playerContainer{background:#fff;border-radius:15px;padding:0;box-shadow:0 10px 30px rgba(0,0,0,.2);position:relative;flex:2;display:flex;flex-direction:row;min-height:0;overflow:hidden}.player{position:relative;width:100%;flex:1;background:#000;border-radius:0;overflow:hidden;display:flex;align-items:center;justify-content:center;min-height:100px}.player-with-controls{display:flex;flex:1;position:relative}.player iframe{border:none;display:none;background-color:#fff;width:100%;height:100%;min-width:100px;min-height:100px}.player iframe.active{display:block}.thumbnail{position:absolute;top:0;left:0;width:100%;height:100%;background:#000;display:flex;align-items:center;justify-content:center;flex-direction:column;cursor:pointer;transition:opacity .3s}.thumbnail.hidden{display:none}.thumbnail img{width:100%;height:100%;object-fit:cover}.playButton{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:80px;height:80px;background:rgba(255,255,255,.9);border:none;border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:30px;color:#000;transition:.3s;box-shadow:0 5px 15px rgba(0,0,0,.3)}.playButton:hover{background:#fff;transform:translate(-50%,-50%) scale(1.1)}.playButton::before{content:'‚ñ∂';margin-left:5px}.controls{display:flex;flex-direction:column;align-items:center;justify-content:flex-start;gap:5px;padding:8px;background:#000000ff;border-radius:0 15px 15px 0;flex-shrink:0;width:40px}.controls-top{display:flex;flex-direction:column;gap:5px}.controls-bottom{display:flex;flex-direction:column;gap:5px;margin-top:auto}.control-button{width:26px;height:26px;background:rgba(255,255,255,.2);color:#fff;border:none;border-radius:4px;cursor:pointer;font-size:12px;transition:.2s;display:flex;align-items:center;justify-content:center;position:relative}.control-button:hover{background:rgba(255,255,255,.3)}.control-button.narrow::before{content:'';width:8px;height:10px;border:2px solid #fff;border-radius:2px;background:0 0}.control-button.wide::before{content:'';width:14px;height:8px;border:2px solid #fff;border-radius:2px;background:0 0}.control-button.fullscreen::before{content:'';width:12px;height:12px;border:2px dashed #fff;border-radius:2px;background:0 0}.control-button:disabled{background:#ccc;cursor:not-allowed}@media (max-width:900px){body{overflow-y:auto;padding-bottom:60px}.container{height:auto;min-height:auto;overflow:visible}.game-title{font-size:2rem}.main-content{flex-direction:column;height:auto;min-height:auto;overflow:visible}.playerContainer{flex-direction:column;height:auto;min-height:300px;flex:none;order:1}.player{height:50vh;min-height:300px;max-height:500px}.playButton{width:60px;height:60px;font-size:24px}.controls{flex-direction:row;justify-content:space-between;width:100%;padding:10px;border-radius:0 0 15px 15px;position:relative;right:auto;top:auto;bottom:auto;height:60px;flex-shrink:0}.controls-bottom,.controls-top{flex-direction:row;gap:0;margin-top:0}}</style><script src="https://www.moly.win/info_.js"></script><script src="comments_.js"></script></head><body><script>(()=>{function t(t,e){if("undefined"==typeof document||!e)return null;const n=document.getElementById(t);if(n)return n;const i=document.createElement("style");return i.id=t,i.textContent=e,document.head.appendChild(i),i}function e(){return"desktop"!==function(){const t=navigator.userAgent.toLowerCase();return/mobile|iphone|ipod|android.*mobile|windows phone/.test(t)?"mobile":/ipad|tablet|android(?!.*mobile)/.test(t)?"tablet":"desktop"}()}async function n(t,e={}){try{const n=localStorage.getItem("auth_token");n&&(e.headers={...e.headers,Authorization:`Bearer ${n}`});const i=await fetch(t,e);if(401===i.status)throw await async function(t){localStorage.removeItem("user"),localStorage.removeItem("auth_token");let e="Î°úÍ∑∏Ïù∏ ÏÑ∏ÏÖòÏù¥ ÎßåÎ£åÎêòÏóàÏäµÎãàÎã§.";try{const n=await t.json();n.message&&(e+=`\n\nÏÉÅÏÑ∏: ${n.message}`)}catch(t){}alert(e+"\n\nÎã§Ïãú Î°úÍ∑∏Ïù∏Ìï¥Ï£ºÏÑ∏Ïöî.");const n="undefined"!=typeof window&&window.isTestMode?"/index.html":"/index";window.location.href=n}(i),new Error("Unauthorized - Session expired");return i}catch(t){throw t}}const i="star",o="star-filled",a="star-half",s="star-empty",r="user-rated";class c{constructor(){this.initStyles()}initStyles(){t("stars-style",`\n.${i} {\n  display: inline-block;\n  font-size: 1rem;\n  line-height: 1;\n  color: #00000022;\n  transition: transform 0.2s ease;\n}\n.${o} {\n  color: #a3491e;\n}\n.${a} {\n  background: linear-gradient(to right, #a3491e 50%, #00000022 50%);\n  -webkit-background-clip: text;\n  background-clip: text;\n  -webkit-text-fill-color: transparent;\n  position: relative;\n}\n.${s} {\n  color: #00000022;\n}\n.${i}.${r} {\n  color: #a3491e;\n}\n`)}static clamp(t,e,n){return Number.isNaN(t)?e:Math.min(Math.max(t,e),n)}static resolveContainer(t){return t?"string"==typeof t?"undefined"==typeof document?null:document.querySelector(t):"object"==typeof t&&"innerHTML"in t?t:null:null}createStarHtml(t,e,n){const o=[i,t];return n&&o.push(r),`<span class="${o.join(" ")}" data-value="${e}">‚òÖ</span>`}addFullStar(t,e,n){t.push(this.createStarHtml(o,e,n))}addHalfStar(t,e,n){t.push(this.createStarHtml(a,e,n))}addEmptyStar(t,e,n){t.push(this.createStarHtml(s,e,n))}buildStarsHTML(t=0,e=null){const n=c.clamp(Number(t)||0,0,5),i=null==e?null:c.clamp(Number(e)||0,0,5),o=[];let a=1;const s=Math.floor(n);for(let t=0;t<s&&a<=5;t+=1){const t=null!==i&&i>=a;this.addFullStar(o,a,t),a+=1}if(n%1>=.5&&a<=5){const t=null!==i&&i>=a;this.addHalfStar(o,a,t),a+=1}for(;a<=5;){const t=null!==i&&i>=a;this.addEmptyStar(o,a,t),a+=1}return o.join("")}renderStars(t,e=0,n=null){const i=this.buildStarsHTML(e,n),o=c.resolveContainer(t);return o&&(o.innerHTML=i),i}}const d=new c;!function(){"use strict";const t=["moly.win","www.moly.win"];if(window.MY_PATTERN1="sunset_bird_94!forest","file:"===window.location.protocol)return void(document.documentElement.innerHTML="");let e=window.location.hostname;function n(e){return t.some(t=>e===t||e.endsWith("."+t))}if(window.location.port&&(e+=":"+window.location.port),n(e)){if(window!==window.top)try{if(!n(window.parent.location.hostname+(window.parent.location.port?":"+window.parent.location.port:"")))return void(window.parent.location.href="https://moly.win")}catch(t){return void(window.parent.location.href="https://moly.win")}}else!function(){const t=window.location.pathname,e=window.location.search,n=window.location.hash;let i="";const o=t.indexOf("/games/");i=-1!==o?t.substring(o):"/";const a="https://moly.win"+i+e+n;window.location.replace(a)}()}();const l=new class{constructor(){this.init(),this.storageKey="user",this.load()}init(){this.idx=null,this.name=null,this.email=null,this.nickname=null,this.picture=null,this.level=1,this.score=0}set(t,e,n,i,o,a=1,s=0){this.idx=t,this.name=e,this.email=n,this.nickname=i,this.picture=o,this.level=a,this.score=s}get(){return{idx:this.idx,name:this.name,email:this.email,nickname:this.nickname,picture:this.picture,level:this.level,score:this.score}}isLogin(){return null!==this.email&&null!==this.name}load(){const t=localStorage.getItem(this.storageKey);if(t)try{const e=JSON.parse(t);this.set(e.idx||null,e.name,e.email,e.nickname,e.picture,e.level||1,e.score||0)}catch(t){localStorage.removeItem(this.storageKey),this.init()}}save(){localStorage.setItem(this.storageKey,JSON.stringify(this.get()))}logout(){this.init(),localStorage.removeItem(this.storageKey),"undefined"!=typeof google&&google.accounts&&google.accounts.id.disableAutoSelect();const t=document.querySelector(".user-menu"),e=document.getElementById("google-login-button");t&&(t.style.display="none"),e&&(e.style.display="block"),window.location.reload()}};class u{constructor(t){if(!t)return;this.sClientID="926501929839-htrnem71i17j105iub5agesekp94rn4i.apps.googleusercontent.com",this.loginButton=t,this.userMenu=document.querySelector(".user-menu"),this.userAvatar=document.querySelector(".user-avatar"),this.logoutItem=document.querySelector(".logout-item"),this.userButton=document.querySelector(".user-button"),this.userDropdown=document.querySelector(".user-dropdown"),this.isTestMode="undefined"!=typeof window&&void 0!==window.isTestMode?Boolean(window.isTestMode):"localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname,this.nicknameModal=document.getElementById("nickname-modal"),this.nicknameInput=document.getElementById("nickname-input"),this.nicknameError=document.getElementById("nickname-error"),this.confirmNicknameBtn=document.getElementById("confirm-nickname"),this.cancelNicknameBtn=document.getElementById("cancel-nickname"),this.closeNicknameModalBtn=document.querySelector(".close-nickname-modal"),this.setupEventListeners();const e=this,n=()=>{if("undefined"!=typeof google&&google.accounts){const n="localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname,i=this.isTestMode;google.accounts.id.initialize({client_id:e.sClientID,"data-context":"signin",callback:e.onGoogleSignIn.bind(e),auto_select:!n&&!i});let o,a=window.innerWidth<=900?"icon":"standard";google.accounts.id.renderButton(t,{theme:"outline",size:"large",type:a}),window.addEventListener("resize",()=>{clearTimeout(o),o=setTimeout(()=>{const o=window.innerWidth<=900?"icon":"standard";a!==o&&(a=o,t.innerHTML="",google.accounts.id.renderButton(t,{theme:"outline",size:"large",type:o}),(n||i)&&e.addTestOverlay(t))},250)}),(n||i)&&e.addTestOverlay(t),l&&l.isLogin()?e.updateUserMenu(l.get().picture):n||i||google.accounts.id.prompt()}else setTimeout(n,100)};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",n):n()}setupEventListeners(){this.userButton&&this.userDropdown&&(this.userButton.addEventListener("click",t=>{t.stopPropagation(),this.userDropdown.classList.toggle("show")}),document.addEventListener("click",t=>{this.userMenu&&!this.userMenu.contains(t.target)&&this.userDropdown.classList.remove("show")})),this.confirmNicknameBtn&&this.confirmNicknameBtn.addEventListener("click",()=>this.handleNicknameConfirm()),this.cancelNicknameBtn&&this.cancelNicknameBtn.addEventListener("click",()=>this.hideNicknameModal()),this.closeNicknameModalBtn&&this.closeNicknameModalBtn.addEventListener("click",()=>this.hideNicknameModal()),this.nicknameInput&&this.nicknameInput.addEventListener("keypress",t=>{"Enter"===t.key&&this.handleNicknameConfirm()})}showNicknameModal(){this.nicknameModal&&(this.nicknameModal.classList.remove("hidden"),this.nicknameInput&&this.nicknameInput.focus())}hideNicknameModal(){this.nicknameModal&&(this.nicknameModal.classList.add("hidden"),this.nicknameInput&&(this.nicknameInput.value=""),this.nicknameError&&this.nicknameError.classList.add("hidden"))}showNicknameError(t){this.nicknameError&&(this.nicknameError.textContent=t,this.nicknameError.classList.remove("hidden"))}hideNicknameError(){this.nicknameError&&this.nicknameError.classList.add("hidden")}async checkNicknameDuplicate(t){try{const e=await fetch(`${API_BASE_URL}/api/users/check-nickname?nickname=${encodeURIComponent(t)}`);return(await e.json()).exists||!1}catch(t){return!1}}async handleNicknameConfirm(){const t=this.nicknameInput?this.nicknameInput.value.trim():"";if(!t)return void this.showNicknameError("ÎãâÎÑ§ÏûÑÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.");if(t.length<2||t.length>20)return void this.showNicknameError("ÎãâÎÑ§ÏûÑÏùÄ 2-20Ïûê ÏÇ¨Ïù¥Î°ú ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.");await this.checkNicknameDuplicate(t)?this.showNicknameError("Ïù¥ÎØ∏ ÏÇ¨Ïö© Ï§ëÏù∏ ÎãâÎÑ§ÏûÑÏûÖÎãàÎã§."):(this.hideNicknameError(),this.hideNicknameModal(),await this.completeRegistration(t))}async completeRegistration(t){try{if(!this.pendingUserData)return;if(!this.pendingGoogleResponse)throw new Error("Google authentication data is missing. Please try logging in again.");if(!(this.pendingUserData.name&&this.pendingUserData.id&&this.pendingUserData.email&&this.pendingUserData.picture))throw new Error("Incomplete user data. Please try logging in again.");const e=await fetch(`${API_BASE_URL}/api/users/post`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.pendingGoogleResponse.credential}`},credentials:"include",body:JSON.stringify({name:this.pendingUserData.name,id:this.pendingUserData.id,email:this.pendingUserData.email,picture:this.pendingUserData.picture,nickname:t})});if(!e.ok){const t=await e.json();throw new Error(t.message||"Registration failed")}const n=await e.json();if(!n.success)throw new Error("Registration failed");if(!n.user)throw new Error("Invalid API response format");n.token&&localStorage.setItem("auth_token",n.token),l.set(n.user.idx,this.pendingUserData.name,this.pendingUserData.email,t,this.pendingUserData.picture,n.user.level||1,0),l.save(),this.updateUserMenu(this.pendingUserData.picture),this.pendingGoogleResponse=null,this.pendingUserData=null,alert(`üéâ ÌôòÏòÅÌï©ÎãàÎã§, ${t}Îãò!\n\nMoly.winÏóê ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Í∞ÄÏûÖÎêòÏóàÏäµÎãàÎã§.`),window.location.reload()}catch(t){alert(t.message||"Registration failed. Please try again.")}}updateUserMenu(t){const e=document.getElementById("google-login-button"),n=document.querySelector(".user-menu"),i=document.querySelector(".user-avatar");e&&(e.style.display="none"),n&&(n.style.display="flex",i&&t&&(i.src=t,i.alt=l.get().nickname||l.get().name||"User"))}decodeJwtResponse(t){const e=t.split(".");if(3!==e.length)throw new Error("JWT format is invalid");return(t=>{const e=t.replace(/-/g,"+").replace(/_/g,"/"),n=atob(e);return JSON.parse(n)})(e[1])}async handleTestLogin(){const t={email:"admin@localhost.com",name:"ÌÖåÏä§Ìä∏ Í¥ÄÎ¶¨Ïûê",id:"admin_user_1",picture:"https://example.com/admin-avatar.jpg",nickname:"admin"},e=`test_token_${Date.now()}`;try{await this.onSignIn(t,{credential:e,isTestLogin:!0},{allowRegistration:!1,onMissingUser:()=>{alert("ÌÖåÏä§Ìä∏ ÏÇ¨Ïö©ÏûêÍ∞Ä ÏóÜÏäµÎãàÎã§.\n\nÎ®ºÏ†Ä createTestUser.jsÎ•º Ïã§ÌñâÌïòÏó¨ ÌÖåÏä§Ìä∏ ÏÇ¨Ïö©ÏûêÎ•º ÏÉùÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî.\n\nÏÉùÏÑ±Îêú ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥:\n- email: admin@localhost.com\n- nickname: admin")}})}catch(t){alert(`ÌÖåÏä§Ìä∏ Î°úÍ∑∏Ïù∏ Ïã§Ìå®: ${t.message}`)}}addTestOverlay(t){if(!this.isTestMode||!t)return;"static"===window.getComputedStyle(t).position&&(t.style.position="relative");let e=t.querySelector(".google-test-overlay");e||(e=document.createElement("div"),e.className="google-test-overlay",e.style.cssText="\n            position: absolute;\n            inset: 0;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            text-align: center;\n            background: rgba(0, 0, 0, 0.1);\n            color: #fff;\n            font-size: 0.95rem;\n            font-weight: 600;\n            border-radius: inherit;\n            cursor: pointer;\n            padding: 12px;\n            z-index: 10;\n        ",e.innerHTML='\n            <div>\n                <span style="font-size: 0.85rem; font-weight: 500;">ÌÖåÏä§Ìä∏ Í≥ÑÏ†ï</span>\n            </div>\n        ',e.addEventListener("click",async t=>{t.preventDefault(),t.stopPropagation(),e.style.pointerEvents="none",e.dataset.loading="true";const n=e.innerHTML;e.innerHTML="\n                <div>\n                    ÌÖåÏä§Ìä∏ Í≥ÑÏ†ï Î°úÍ∑∏Ïù∏ Ï§ë...\n                </div>\n            ";try{await this.handleTestLogin()}catch(t){}finally{e.style.pointerEvents="auto",delete e.dataset.loading,e.innerHTML=n}}),t.appendChild(e))}async onSignIn(t,e,n={}){const{allowRegistration:i=!0,onMissingUser:o}=n,a=e&&e.credential;if(!t||!t.email)throw new Error("Invalid user data received from authentication provider.");if(!a)throw new Error("Authentication credential is missing.");try{const n=await fetch(`${API_BASE_URL}/api/users/check-email?email=${encodeURIComponent(t.email)}`);if((await n.json()).exists){const e=await fetch(`${API_BASE_URL}/api/users/login`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},credentials:"include",body:JSON.stringify({email:t.email})});if(!e.ok){const t=await e.json();throw new Error(t.message||"Login failed")}const n=await e.json();if(!n.success)throw new Error("Login failed");n.token&&localStorage.setItem("auth_token",n.token),l.set(n.user.idx,n.user.name||t.name,n.user.email||t.email,n.user.nickname||t.nickname,n.user.picture||t.picture,n.user.level||1,0),l.save(),this.updateUserMenu(n.user.picture||t.picture),window.location.reload()}else{if(!i){if("function"!=typeof o)throw new Error("User not found and registration is not allowed.");return void o()}this.pendingGoogleResponse=e,this.pendingUserData={name:t.name||(t.given_name?t.given_name+" "+(t.family_name||""):""),id:t.sub||t.id,email:t.email,picture:t.picture},this.showNicknameModal()}}catch(t){if("localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname||this.isTestMode)return;alert(t.message||"Login failed. Please try again.")}}onGoogleSignIn=async t=>{const e=this.decodeJwtResponse(t.credential);await this.onSignIn(e,t,{allowRegistration:!0})}}document.addEventListener("DOMContentLoaded",function(){const t=document.getElementById("google-login-button");if(t){new u(t)}});class m{constructor(){this.dbName="MolyGamesDB",this.dbVersion=2,this.storeName="games",this.metaStoreName="meta",this.likesStoreName="game_likes",this.favoritesStoreName="game_favorites",this.ratingsStoreName="game_ratings",this.db=null}async init(){return new Promise((t,e)=>{const n=indexedDB.open(this.dbName,this.dbVersion);n.onerror=()=>{e(new Error("IndexedDB Ï¥àÍ∏∞Ìôî Ïã§Ìå®"))},n.onsuccess=()=>{this.db=n.result,t(this.db)},n.onupgradeneeded=t=>{const e=t.target.result,n=t.oldVersion;if(!e.objectStoreNames.contains(this.storeName)){e.createObjectStore(this.storeName,{keyPath:"id"}).createIndex("id","id",{unique:!0})}if(e.objectStoreNames.contains(this.metaStoreName)||e.createObjectStore(this.metaStoreName,{keyPath:"key"}),n<2){if(!e.objectStoreNames.contains(this.likesStoreName)){e.createObjectStore(this.likesStoreName,{keyPath:"game_id"}).createIndex("game_id","game_id",{unique:!0})}if(!e.objectStoreNames.contains(this.favoritesStoreName)){e.createObjectStore(this.favoritesStoreName,{keyPath:"game_id"}).createIndex("game_id","game_id",{unique:!0})}if(!e.objectStoreNames.contains(this.ratingsStoreName)){e.createObjectStore(this.ratingsStoreName,{keyPath:"game_id"}).createIndex("game_id","game_id",{unique:!0})}}}})}async saveGames(t){return this.db||await this.init(),new Promise((e,n)=>{const i=this.db.transaction([this.storeName],"readwrite"),o=i.objectStore(this.storeName);o.clear(),t.forEach(t=>{o.add({id:t.id,view_count:t.view_count||0,like_count:t.like_count||0,score:t.score||0,rating_total:t.rating_total||0,rating_count:t.rating_count||0,rating_avg:t.rating_avg||0,created_at:t.created_at||(new Date).toISOString()})}),i.oncomplete=()=>{e()},i.onerror=()=>{n(new Error("Í≤åÏûÑ Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû• Ïã§Ìå®"))}})}async getGames(){return this.db||await this.init(),new Promise((t,e)=>{const n=this.db.transaction([this.storeName],"readonly").objectStore(this.storeName).getAll();n.onsuccess=()=>{t(n.result||[])},n.onerror=()=>{e(new Error("Í≤åÏûÑ Îç∞Ïù¥ÌÑ∞ Ï°∞Ìöå Ïã§Ìå®"))}})}async getGame(t){return this.db||await this.init(),new Promise((e,n)=>{const i=this.db.transaction([this.storeName],"readonly").objectStore(this.storeName).get(t);i.onsuccess=()=>{e(i.result||null)},i.onerror=()=>{n(new Error("Í≤åÏûÑ Îç∞Ïù¥ÌÑ∞ Ï°∞Ìöå Ïã§Ìå®"))}})}async updateGames(t){return this.db||await this.init(),new Promise((e,n)=>{const i=this.db.transaction([this.storeName],"readwrite"),o=i.objectStore(this.storeName),a=t.map(t=>new Promise((e,n)=>{const i=o.get(t.id);i.onsuccess=()=>{const a=i.result,s={id:t.id,view_count:a?.view_count??t.view_count??0,like_count:a?.like_count??t.like_count??0,score:a?.score??t.score??0,rating_total:a?.rating_total??t.rating_total??0,rating_count:a?.rating_count??t.rating_count??0,rating_avg:a?.rating_avg??t.rating_avg??0,created_at:a?.created_at??t.created_at??(new Date).toISOString()},r=o.put(s);r.onsuccess=()=>e(),r.onerror=()=>n(new Error(`Í≤åÏûÑ ${t.id} ÏóÖÎç∞Ïù¥Ìä∏ Ïã§Ìå®`))},i.onerror=()=>n(new Error(`Í≤åÏûÑ ${t.id} Ï°∞Ìöå Ïã§Ìå®`))}));Promise.all(a).then(()=>{i.oncomplete=()=>e()}).catch(n)})}async setLastUpdateDate(t){return this.db||await this.init(),new Promise((e,n)=>{const i=this.db.transaction([this.metaStoreName],"readwrite").objectStore(this.metaStoreName).put({key:"lastUpdateDate",value:t});i.onsuccess=()=>e(),i.onerror=()=>n(new Error("ÏóÖÎç∞Ïù¥Ìä∏ ÎÇ†Ïßú Ï†ÄÏû• Ïã§Ìå®"))})}async getLastUpdateDate(){return this.db||await this.init(),new Promise((t,e)=>{const n=this.db.transaction([this.metaStoreName],"readonly").objectStore(this.metaStoreName).get("lastUpdateDate");n.onsuccess=()=>{const e=n.result;t(e?e.value:null)},n.onerror=()=>{e(new Error("ÏóÖÎç∞Ïù¥Ìä∏ ÎÇ†Ïßú Ï°∞Ìöå Ïã§Ìå®"))}})}async needsUpdate(){try{const t=await this.getLastUpdateDate();if(!t)return!0;const e=new Date(t),n=new Date;return(n-e)/864e5>=1}catch(t){return!0}}async fetchGamesFromServer(){try{const t="https://www.moly.win/api/games",e=await fetch(t);if(!e.ok)throw new Error(`ÏÑúÎ≤Ñ ÏùëÎãµ Ïò§Î•ò: ${e.status}`);const n=await e.json();if(n.success&&n.data)return await this.saveGames(n.data),await this.setLastUpdateDate(n.updated_at||(new Date).toISOString()),n.data;throw new Error("ÏÑúÎ≤Ñ ÏùëÎãµ ÌòïÏãù Ïò§Î•ò")}catch(t){throw t}}async syncGames(t){try{let e=await this.getGames();if(0===e.length||await this.needsUpdate())try{e=await this.fetchGamesFromServer()}catch(t){e=await this.getGames()}const n=new Map;e.forEach(t=>{n.set(t.id,t)}),t.forEach(t=>{n.has(t.id)||n.set(t.id,{id:t.id,view_count:0,like_count:0,score:0,rating_total:0,rating_count:0,rating_avg:0,created_at:(new Date).toISOString()})});const i=Array.from(n.values());return await this.updateGames(i),i}catch(e){return t.map(t=>({id:t.id,view_count:0,like_count:0,score:0,rating_total:0,rating_count:0,rating_avg:0,created_at:(new Date).toISOString()}))}}async addLike(t){return this.db||await this.init(),new Promise((e,n)=>{const i=this.db.transaction([this.likesStoreName],"readwrite").objectStore(this.likesStoreName).put({game_id:t,created_at:(new Date).toISOString()});i.onsuccess=()=>e(!0),i.onerror=()=>n(new Error("Ï¢ãÏïÑÏöî Ï∂îÍ∞Ä Ïã§Ìå®"))})}async removeLike(t){return this.db||await this.init(),new Promise((e,n)=>{const i=this.db.transaction([this.likesStoreName],"readwrite").objectStore(this.likesStoreName).delete(t);i.onsuccess=()=>e(!0),i.onerror=()=>n(new Error("Ï¢ãÏïÑÏöî Ï†úÍ±∞ Ïã§Ìå®"))})}async isLiked(t){return this.db||await this.init(),new Promise((e,n)=>{const i=this.db.transaction([this.likesStoreName],"readonly").objectStore(this.likesStoreName).get(t);i.onsuccess=()=>e(!!i.result),i.onerror=()=>n(new Error("Ï¢ãÏïÑÏöî ÏÉÅÌÉú ÌôïÏù∏ Ïã§Ìå®"))})}async getAllLikes(){return this.db||await this.init(),new Promise((t,e)=>{const n=this.db.transaction([this.likesStoreName],"readonly").objectStore(this.likesStoreName).getAll();n.onsuccess=()=>t(n.result||[]),n.onerror=()=>e(new Error("Ï¢ãÏïÑÏöî Î™©Î°ù Ï°∞Ìöå Ïã§Ìå®"))})}async addFavorite(t){return this.db||await this.init(),new Promise((e,n)=>{const i=this.db.transaction([this.favoritesStoreName],"readwrite").objectStore(this.favoritesStoreName).put({game_id:t,created_at:(new Date).toISOString()});i.onsuccess=()=>e(!0),i.onerror=()=>n(new Error("Ï¶êÍ≤®Ï∞æÍ∏∞ Ï∂îÍ∞Ä Ïã§Ìå®"))})}async removeFavorite(t){return this.db||await this.init(),new Promise((e,n)=>{const i=this.db.transaction([this.favoritesStoreName],"readwrite").objectStore(this.favoritesStoreName).delete(t);i.onsuccess=()=>e(!0),i.onerror=()=>n(new Error("Ï¶êÍ≤®Ï∞æÍ∏∞ Ï†úÍ±∞ Ïã§Ìå®"))})}async isFavorite(t){return this.db||await this.init(),new Promise((e,n)=>{const i=this.db.transaction([this.favoritesStoreName],"readonly").objectStore(this.favoritesStoreName).get(t);i.onsuccess=()=>e(!!i.result),i.onerror=()=>n(new Error("Ï¶êÍ≤®Ï∞æÍ∏∞ ÏÉÅÌÉú ÌôïÏù∏ Ïã§Ìå®"))})}async getAllFavorites(){return this.db||await this.init(),new Promise((t,e)=>{const n=this.db.transaction([this.favoritesStoreName],"readonly").objectStore(this.favoritesStoreName).getAll();n.onsuccess=()=>t(n.result||[]),n.onerror=()=>e(new Error("Ï¶êÍ≤®Ï∞æÍ∏∞ Î™©Î°ù Ï°∞Ìöå Ïã§Ìå®"))})}async setRating(t,e){return this.db||await this.init(),new Promise((n,i)=>{const o=this.db.transaction([this.ratingsStoreName],"readwrite").objectStore(this.ratingsStoreName).put({game_id:t,rating:e,created_at:(new Date).toISOString()});o.onsuccess=()=>n(!0),o.onerror=()=>i(new Error("ÌèâÏ†ê Ï†ÄÏû• Ïã§Ìå®"))})}async removeRating(t){return this.db||await this.init(),new Promise((e,n)=>{const i=this.db.transaction([this.ratingsStoreName],"readwrite").objectStore(this.ratingsStoreName).delete(t);i.onsuccess=()=>e(!0),i.onerror=()=>n(new Error("ÌèâÏ†ê Ï†úÍ±∞ Ïã§Ìå®"))})}async getRating(t){return this.db||await this.init(),new Promise((e,n)=>{const i=this.db.transaction([this.ratingsStoreName],"readonly").objectStore(this.ratingsStoreName).get(t);i.onsuccess=()=>e(i.result?i.result.rating:null),i.onerror=()=>n(new Error("ÌèâÏ†ê Ï°∞Ìöå Ïã§Ìå®"))})}async getAllRatings(){return this.db||await this.init(),new Promise((t,e)=>{const n=this.db.transaction([this.ratingsStoreName],"readonly").objectStore(this.ratingsStoreName).getAll();n.onsuccess=()=>t(n.result||[]),n.onerror=()=>e(new Error("ÌèâÏ†ê Î™©Î°ù Ï°∞Ìöå Ïã§Ìå®"))})}async getUserGameData(t){this.db||await this.init();try{const[e,n,i]=await Promise.all([this.isLiked(t),this.isFavorite(t),this.getRating(t)]);return{isLiked:e,isFavorite:n,rating:i}}catch(t){return{isLiked:!1,isFavorite:!1,rating:null}}}}const h="popupStarsStyles";const p=new class{constructor(t={}){this.buttonId=t.buttonId||"ratingButton",this.popupId=t.popupId||"ratingPopup",this.starsId=t.starsContainerId||"ratingPopupStars",this.button=null,this.popup=null,this.starsContainer=null,this.isOpen=!1,this.isInitialized=!1,this.onButtonClick=this.onButtonClick.bind(this),this.handleDocumentClick=this.handleDocumentClick.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.boundPosition=this.position.bind(this),this.handlePopupClick=t=>t.stopPropagation(),this.initStyles()}initStyles(){const e="\n.rating-popup {\n  position: fixed;\n  top: 0;\n  left: 0;\n  opacity: 0;\n  pointer-events: none;\n  z-index: 11000;\n  background: #f2b32b;\n  border: 1px solid #a64a1f;\n  border-radius: 12px;\n  box-shadow: 0 8px 20px rgba(0,0,0,0.15);\n  padding: 14px;\n  min-width: 200px;\n  max-width: min(280px, calc(100vw - 32px));\n  transform: translate(-50%, -8px);\n  transition: opacity 0.2s ease, transform 0.2s ease;\n  will-change: top, left, transform;\n}\n.rating-popup.open {\n  opacity: 1;\n  pointer-events: auto;\n  transform: translate(-50%, 0);\n}\n.rating-popup::after {\n  content: '';\n  position: absolute;\n  left: 50%;\n  transform: translateX(-50%);\n  border-width: 8px;\n  border-style: solid;\n  border-color: transparent;\n  display: none;\n}\n.rating-popup.above::after,\n.rating-popup.below::after {\n  display: block;\n}\n.rating-popup.above::after {\n  top: 100%;\n  border-top-color: #f2b32b;\n}\n.rating-popup.below::after {\n  bottom: 100%;\n  border-bottom-color: #f2b32b;\n}\n.rating-popup-content {\n  display: flex;\n  flex-direction: column;\n  gap: 10px;\n}\n.rating-popup-title {\n  font-size: 0.9rem;\n  font-weight: 600;\n  color: #000;\n}\n.rating-popup-stars {\n  display: flex;\n  gap: 6px;\n  align-items: center;\n  justify-content: flex-start;\n}\n.rating-popup-row {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n  flex-wrap: nowrap;\n}\n.rating-popup-stars .star {\n  cursor: pointer;\n}\n.rating-popup-stars .star:hover {\n  transform: scale(1.2);\n}\n.rating-confirm-button {\n  background: #f2b32b;\n  color: #000;\n  border: 1px solid #a64a1f;\n  border-radius: 10px;\n  padding: 8px 14px;\n  font-size: 0.85rem;\n  font-weight: 600;\n  cursor: pointer;\n  transition: background 0.3s ease, transform 0.2s ease;\n  min-width: 70px;\n}\n.rating-confirm-button:hover:not(:disabled) {\n  background: #ffaa00;\n  transform: translateY(-1px);\n}\n.rating-confirm-button:disabled {\n  background: #e0e0e0;\n  color: #888;\n  border-color: #ccc;\n  cursor: not-allowed;\n  transform: none;\n}\n";t(h,e)}init(){if("undefined"==typeof document)return!1;const t=document.getElementById(this.buttonId),e=document.getElementById(this.popupId),n=document.getElementById(this.starsId);return!!(t&&e&&n)&&(this.button=t,this.popup=e,this.starsContainer=n,this.popup.parentElement!==document.body&&document.body.appendChild(this.popup),this.popup.style.transform="translate(-50%, -8px)",this.button.setAttribute("aria-haspopup","dialog"),this.button.setAttribute("aria-expanded","false"),this.isInitialized||(this.button.addEventListener("click",this.onButtonClick),this.popup.addEventListener("click",this.handlePopupClick),document.addEventListener("click",this.handleDocumentClick),this.isInitialized=!0),!0)}onButtonClick(t){t.stopPropagation(),this.button&&!this.button.disabled&&(this.isOpen?this.close():this.open())}handleDocumentClick(t){this.isOpen&&this.popup&&this.button&&(this.popup.contains(t.target)||this.button.contains(t.target)||this.close())}handleKeydown(t){"Escape"===t.key&&this.close()}open(){this.popup&&this.button&&(this.isOpen||(this.isOpen=!0,this.popup.classList.add("open"),this.button.setAttribute("aria-expanded","true"),this.position(),window.addEventListener("resize",this.boundPosition),window.addEventListener("scroll",this.boundPosition,!0),document.addEventListener("keydown",this.handleKeydown)))}close(){this.popup&&this.button&&this.isOpen&&(this.isOpen=!1,this.popup.classList.remove("open","above","below"),this.popup.style.transform="translate(-50%, -8px)",this.button.setAttribute("aria-expanded","false"),window.removeEventListener("resize",this.boundPosition),window.removeEventListener("scroll",this.boundPosition,!0),document.removeEventListener("keydown",this.handleKeydown))}position(){if(!this.isOpen)return;if(!this.popup||!this.button)return;const t=this.button.getBoundingClientRect(),e=this.popup.getBoundingClientRect(),n=window.innerWidth,i=window.innerHeight;let o=t.top-e.height-12,a="above";if(o<16&&(o=t.bottom+12,a="below"),"below"===a&&o+e.height>i-16){const n=t.top-e.height-12;n>=16?(o=n,a="above"):o=Math.max(16,i-e.height-16)}"above"===a&&o<16&&(o=Math.max(16,t.bottom+12),a="below");let s=t.left+t.width/2;s=Math.min(n-16,Math.max(16,s)),this.popup.classList.remove("above","below"),this.popup.classList.add(a),this.popup.style.top=`${o}px`,this.popup.style.left=`${s}px`,this.popup.style.transform="translate(-50%, 0)"}};let g=!1,y=!1,w="",f=0,v=0,b=null,E={};function k(){return window.innerWidth<=768}function I(){const t=document.getElementById("playerContainer"),e=t.getAttribute("data-left-keys"),n=t.getAttribute("data-right-keys"),i=e?JSON.parse(e):[],o=n?JSON.parse(n):[];E={thumbnail:t.getAttribute("data-thumbnail"),name:t.getAttribute("data-name"),gameUrl:t.getAttribute("data-game-url"),resolution:t.getAttribute("data-resolution"),leftKeys:i,rightKeys:o},w=E.resolution;const a=function(t){if(!t)return{width:0,height:0};const e=t.split("x");return 2!==e.length?{width:0,height:0}:{width:parseInt(e[0],10)||0,height:parseInt(e[1],10)||0}}(E.resolution);f=a.width,v=a.height,t.innerHTML='\n        <div class="player-with-controls">\n            <div class="player">\n                <div class="thumbnail" id="thumbnail">\n                    <img id="thumbnailImg" alt="">\n                    <button class="playButton" id="playButton"></button>\n                </div>\n                <iframe id="gameFrame"></iframe>\n            </div>\n        </div>\n         <div class="controls" id="controls">\n             <div class="controls-top">\n                 <button class="control-button narrow" id="normalBtn" title="Toggle View"></button>\n             </div>\n             <div class="controls-bottom">\n                 <button class="control-button fullscreen" id="fullscreenBtn" title="Full Screen"></button>\n             </div>\n         </div>\n    ',document.getElementById("thumbnailImg").src=E.thumbnail,document.getElementById("thumbnailImg").alt=E.name,b=document.getElementById("gameFrame"),b.dataset.gameUrl=E.gameUrl,document.getElementById("playButton").addEventListener("click",L),document.getElementById("normalBtn").addEventListener("click",B),document.getElementById("fullscreenBtn").addEventListener("click",()=>A("fullscreen")),b.addEventListener("load",S),window.addEventListener("keydown",t=>{if(g&&b&&b.contentWindow)try{b.contentWindow.postMessage({type:"keydown",key:t.key,code:t.code,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey,altKey:t.altKey,metaKey:t.metaKey},"*")}catch(t){}g&&b&&b.focus()}),window.addEventListener("keyup",t=>{if(g&&b&&b.contentWindow)try{b.contentWindow.postMessage({type:"keyup",key:t.key,code:t.code,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey,altKey:t.altKey,metaKey:t.metaKey},"*")}catch(t){}})}function L(){if(g)return;const t=document.getElementById("thumbnail"),n=document.getElementById("gameFrame");document.getElementById("controls");window.gameAPI&&window.gameAPI.gameId&&window.gameAPI.incrementView(),t.classList.add("hidden"),n.classList.add("active"),n.src=n.dataset.gameUrl;const i=E.leftKeys&&E.leftKeys.length>0||E.rightKeys&&E.rightKeys.length>0;void 0!==e&&e()&&i&&C(),g=!0}function S(){}let x="normal";function B(){A("normal"===x?"landscape":"normal")}function A(t){const e=document.querySelector(".game-info"),n=document.querySelector(".container"),i=document.querySelector(".player"),o=document.getElementById("fullscreenBtn"),a=document.getElementById("normalBtn");switch(x=t,t){case"normal":e.style.display="block",n.style.flexDirection="row",a.classList.remove("narrow"),a.classList.add("wide");break;case"landscape":if(k())return void A("normal");e.style.display="none",n.style.flexDirection="row",a.classList.remove("wide"),a.classList.add("narrow");break;case"fullscreen":if(y)return document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen(),y=!1,void(o.title="Full Screen");i.requestFullscreen?i.requestFullscreen():i.webkitRequestFullscreen?i.webkitRequestFullscreen():i.msRequestFullscreen&&i.msRequestFullscreen(),y=!0,o.title="Ï†ÑÏ≤¥ÌôîÎ©¥ Ï¢ÖÎ£å";break;default:return}g&&b&&b.contentWindow&&setTimeout(()=>{try{b.contentWindow.postMessage({type:"resize",width:b.offsetWidth,height:b.offsetHeight},"*")}catch(t){}},100)}function _(t){return t>=1e6?(t/1e6).toFixed(1).replace(/\.0$/,"")+"M":t>=1e3?(t/1e3).toFixed(1).replace(/\.0$/,"")+"K":t.toString()}function N(){const t=document.getElementById("playerContainer");if(t&&window.GAMES_DB_DATA){const e=t.getAttribute("data-game-id"),n=window.GAMES_DB_DATA.find(t=>t.id===e);if(n){t.setAttribute("data-view-count",n.view_count||0),t.setAttribute("data-like-count",n.like_count||0),t.setAttribute("data-rating-avg",n.rating_avg||0),t.setAttribute("data-rating-count",n.rating_count||0),t.setAttribute("data-rating-total",n.rating_total||0);const e=document.getElementById("gameViews"),i=document.getElementById("gameViewsCount");if(e&&i){const t=n.view_count||0;i.textContent=_(t),e.setAttribute("data-raw-value",t.toString()),e.setAttribute("title",`${t.toLocaleString("ko-KR")} plays`)}}}window.gameAPI&&(window.gameAPI.updateRatingUI(),window.gameAPI.updateLikeUI())}function D(t){const e=document.getElementById("commentsContainer");if(!e)return;if(!t||0===t.length)return void(e.innerHTML='<div class="comments-empty">ÏïÑÏßÅ ÎåìÍ∏ÄÏù¥ ÏóÜÏäµÎãàÎã§.</div>');const n=t.map(t=>{const e=t.nickname||"ÏùµÎ™Ö",n=t.picture||"data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22%3E%3Ccircle cx=%2212%22 cy=%2212%22 r=%2210%22 fill=%22%23ccc%22/%3E%3C/svg%3E",i=M(t.content||""),o=t.created_at?function(t){if(!t)return"";try{const e=new Date(t),n=new Date-e,i=Math.floor(n/1e3),o=Math.floor(i/60),a=Math.floor(o/60),s=Math.floor(a/24);return i<60?"Î∞©Í∏à Ï†Ñ":o<60?`${o}Î∂Ñ Ï†Ñ`:a<24?`${a}ÏãúÍ∞Ñ Ï†Ñ`:s<7?`${s}Ïùº Ï†Ñ`:e.toLocaleDateString("ko-KR",{year:"numeric",month:"long",day:"numeric"})}catch(e){return t}}(t.created_at):"";return`\n            <div class="comment-item">\n                <div class="comment-header">\n                    <img src="${n}" alt="${M(e)}" class="comment-avatar" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22%3E%3Ccircle cx=%2212%22 cy=%2212%22 r=%2210%22 fill=%22%23ccc%22/%3E%3C/svg%3E'">\n                    <div class="comment-user">\n                        <div class="comment-nickname">${M(e)}</div>\n                        ${o?`<div class="comment-date">${o}</div>`:""}\n                    </div>\n                </div>\n                <div class="comment-content">${i}</div>\n            </div>\n        `}).join("");e.innerHTML=n}function M(t){if(!t)return"";const e=document.createElement("div");return e.textContent=t,e.innerHTML}function C(){const t=document.querySelector(".virtual-keyboard-wrapper"),e=document.getElementById("virtualKeyboard"),n=document.getElementById("keyboardLeft"),i=document.getElementById("keyboardRight"),o=document.getElementById("keyboardCloseBtn"),a=document.getElementById("keyboardToggleBtn");if(!(t&&e&&n&&i))return;const s=E&&E.leftKeys&&E.leftKeys.length>0,r=E&&E.rightKeys&&E.rightKeys.length>0;if(s||r){if(n.innerHTML="",i.innerHTML="",s&&function(t,e){let n=new Set,i=new Map,o=new Map,a=!1,s=null;const r=new Map,c=147,d=49;function l(n,i){const o=new Set,a=t.offsetWidth,s=Math.max(0,Math.min(n,a)),r=Math.max(0,Math.min(i,c)),l=Math.floor(s/d),u=Math.floor(r/d);return 0===u?0===l?(e.includes("ArrowLeft")&&o.add("ArrowLeft"),e.includes("ArrowUp")&&o.add("ArrowUp")):1===l?e.includes("ArrowUp")&&o.add("ArrowUp"):l>=2&&(e.includes("ArrowRight")&&o.add("ArrowRight"),e.includes("ArrowUp")&&o.add("ArrowUp")):1===u?0===l?e.includes("ArrowLeft")&&o.add("ArrowLeft"):1===l||l>=2&&e.includes("ArrowRight")&&o.add("ArrowRight"):2===u&&(0===l?(e.includes("ArrowLeft")&&o.add("ArrowLeft"),e.includes("ArrowDown")&&o.add("ArrowDown")):1===l?e.includes("ArrowDown")&&o.add("ArrowDown"):l>=2&&(e.includes("ArrowRight")&&o.add("ArrowRight"),e.includes("ArrowDown")&&o.add("ArrowDown"))),o}function u(t){const e=new Set([...n].filter(e=>!t.has(e))),a=new Set([...t].filter(t=>!n.has(t)));e.forEach(t=>{U(t);const e=r.get(t);e&&e.classList.remove("pressed"),o.has(t)&&(clearTimeout(o.get(t)),o.delete(t)),i.has(t)&&(clearInterval(i.get(t)),i.delete(t))}),a.forEach(t=>{R(t,!1);const e=r.get(t);e&&e.classList.add("pressed");const n=setTimeout(()=>{const e=setInterval(()=>{R(t,!0)},50);i.set(t,e)},500);o.set(t,n)}),n=t}function m(){n.forEach(t=>{U(t);const e=r.get(t);e&&e.classList.remove("pressed"),o.has(t)&&(clearTimeout(o.get(t)),o.delete(t)),i.has(t)&&(clearInterval(i.get(t)),i.delete(t))}),n.clear()}function h(e){const n=t.getBoundingClientRect();let i,o;if(e.touches&&e.touches.length>0){const t=null!==s?Array.from(e.touches).find(t=>t.identifier===s):e.touches[0];if(!t)return null;i=t.clientX-n.left,o=t.clientY-n.top}else i=e.clientX-n.left,o=e.clientY-n.top;return{x:i,y:o}}function p(e){if(e.preventDefault(),e.stopPropagation(),a)return;a=!0,e.touches&&e.touches.length>0&&(s=e.touches[0].identifier);const n=h(e);if(!n)return;u(l(n.x,n.y)),t.classList.add("active")}function g(t){if(!a)return;t.preventDefault(),t.stopPropagation();const e=h(t);if(!e)return;const i=l(e.x,e.y);(i.size!==n.size||[...i].some(t=>!n.has(t)))&&u(i)}function y(e){a&&(e.preventDefault(),e.stopPropagation(),a=!1,s=null,m(),t.classList.remove("active"))}e.forEach(e=>{const n=document.createElement("button");n.className="keyboard-key",n.textContent=T(e),n.dataset.key=e,n.style.pointerEvents="none","ArrowUp"===e?(n.style.left="49px",n.style.top="0"):"ArrowDown"===e?(n.style.left="49px",n.style.bottom="0",n.style.top="auto"):"ArrowLeft"===e?(n.style.left="0",n.style.top="50%",n.style.transform="translateY(-50%)"):"ArrowRight"===e&&(n.style.left="98px",n.style.top="50%",n.style.transform="translateY(-50%)"),t.appendChild(n),r.set(e,n)}),t.addEventListener("mousedown",p),t.addEventListener("mousemove",g),t.addEventListener("mouseup",y),t.addEventListener("mouseleave",y),t.addEventListener("touchstart",p,{passive:!1}),t.addEventListener("touchmove",g,{passive:!1}),t.addEventListener("touchend",y,{passive:!1}),t.addEventListener("touchcancel",y,{passive:!1}),t.style.touchAction="none"}(n,E.leftKeys),r&&E.rightKeys.forEach(t=>{const e=function(t){const e=document.createElement("button");e.className="keyboard-key",e.textContent=T(t),e.dataset.key=t;let n=null,i=!1,o=null;const a=a=>{a.preventDefault(),a.stopPropagation(),i||(i=!0,e.classList.add("pressed"),R(t,!1),o=setTimeout(()=>{n=setInterval(()=>{R(t,!0)},50)},500))},s=a=>{a.preventDefault(),a.stopPropagation(),i&&(i=!1,e.classList.remove("pressed"),o&&(clearTimeout(o),o=null),n&&(clearInterval(n),n=null),U(t))};return e.addEventListener("mousedown",a),e.addEventListener("mouseup",s),e.addEventListener("mouseleave",s),e.addEventListener("touchstart",a,{passive:!1}),e.addEventListener("touchend",s,{passive:!1}),e.addEventListener("touchcancel",s,{passive:!1}),e}(t);i.appendChild(e)}),o){o.replaceWith(o.cloneNode(!0));document.getElementById("keyboardCloseBtn").addEventListener("click",P)}t.classList.add("active"),a&&a.classList.remove("active")}}function P(){const t=document.querySelector(".virtual-keyboard-wrapper"),n=document.getElementById("keyboardToggleBtn");t&&t.classList.remove("active");const i=E&&(E.leftKeys&&E.leftKeys.length>0||E.rightKeys&&E.rightKeys.length>0);n&&void 0!==e&&e()&&i&&n.classList.add("active")}function T(t){return{ArrowUp:"‚Üë",ArrowDown:"‚Üì",ArrowLeft:"‚Üê",ArrowRight:"‚Üí",Enter:"Enter",Escape:"Esc",Space:"Space",Shift:"Shift",Control:"Ctrl",Alt:"Alt",Tab:"Tab",Backspace:"‚å´",Delete:"Del"}[t]||t}function R(t,e=!1){if(void 0===g||!g||void 0===b||!b)return;const n=$(t);if(!e&&b)try{b.focus()}catch(t){}const i=new KeyboardEvent("keydown",{key:t,code:n,bubbles:!0,cancelable:!0,ctrlKey:!1,shiftKey:!1,altKey:!1,metaKey:!1,repeat:e});if(window.dispatchEvent(i),b.contentWindow&&b.contentDocument)try{const i=b.contentDocument,o=b.contentWindow,a=new KeyboardEvent("keydown",{key:t,code:n,bubbles:!0,cancelable:!0,ctrlKey:!1,shiftKey:!1,altKey:!1,metaKey:!1,view:o,repeat:e});(i.body||i.documentElement||i).dispatchEvent(a)}catch(t){}}function U(t){if(void 0===g||!g||void 0===b||!b)return;const e=$(t),n=new KeyboardEvent("keyup",{key:t,code:e,bubbles:!0,cancelable:!0,ctrlKey:!1,shiftKey:!1,altKey:!1,metaKey:!1});if(window.dispatchEvent(n),b.contentWindow&&b.contentDocument)try{const n=b.contentDocument,i=b.contentWindow,o=new KeyboardEvent("keyup",{key:t,code:e,bubbles:!0,cancelable:!0,ctrlKey:!1,shiftKey:!1,altKey:!1,metaKey:!1,view:i});(n.body||n.documentElement||n).dispatchEvent(o)}catch(t){}}function $(t){return{ArrowUp:"ArrowUp",ArrowDown:"ArrowDown",ArrowLeft:"ArrowLeft",ArrowRight:"ArrowRight",Enter:"Enter",Escape:"Escape",Space:"Space",Shift:"ShiftLeft",Control:"ControlLeft",Alt:"AltLeft",Tab:"Tab",Backspace:"Backspace",Delete:"Delete"}[t]||t}document.addEventListener("fullscreenchange",function(){document.fullscreenElement||(y=!1,document.getElementById("fullscreenBtn").style.display="flex",document.getElementById("minimizeBtn").style.display="none")}),window.gameAPI={gameId:null,userRating:null,isLiked:!1,isFavorite:!1,indexedDB:null,async init(t){this.gameId=t;try{this.indexedDB=new m,await this.indexedDB.init(),await this.loadUserDataFromIndexedDB()}catch(t){}await this.loadUserGameData()},async loadUserDataFromIndexedDB(){if(this.indexedDB&&this.gameId)try{const t=await this.indexedDB.getUserGameData(this.gameId);this.userRating=t.rating,this.isLiked=t.isLiked,this.isFavorite=t.isFavorite,this.updateRatingUI(),this.updateLikeUI(),void 0!==F&&F.updateFavoriteState(this.isFavorite)}catch(t){}},async loadUserGameData(){},async syncUserDataToIndexedDB(){if(this.indexedDB&&this.gameId)try{this.userRating?await this.indexedDB.setRating(this.gameId,this.userRating):await this.indexedDB.removeRating(this.gameId),this.isLiked?await this.indexedDB.addLike(this.gameId):await this.indexedDB.removeLike(this.gameId),this.isFavorite?await this.indexedDB.addFavorite(this.gameId):await this.indexedDB.removeFavorite(this.gameId)}catch(t){}},async setRating(t){if(!l||!l.isLogin())return alert("Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§."),!1;if(!this.gameId)return!1;try{const e=await n(`${API_BASE_URL}/api/games/${this.gameId}/rating`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({rating:t})});if(e.ok){const n=await e.json();if(n.success){if(this.userRating=t,this.indexedDB&&await this.indexedDB.setRating(this.gameId,t),n.game){const t=document.getElementById("playerContainer");t&&(t.setAttribute("data-rating-avg",n.game.rating_avg||0),t.setAttribute("data-rating-count",n.game.rating_count||0),t.setAttribute("data-view-count",n.game.view_count||0),t.setAttribute("data-like-count",n.game.like_count||0)),N(),this.indexedDB&&await this.indexedDB.updateGames([n.game])}return this.updateRatingUI(),!0}}return!1}catch(t){return!1}},async toggleLike(){if(!l||!l.isLogin())return alert("Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§."),!1;if(!this.gameId)return!1;try{const t=await n(`${API_BASE_URL}/api/games/${this.gameId}/like`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({action:this.isLiked?"remove":"add"})});if(t.ok){const e=await t.json();if(e.success){if(this.isLiked=!this.isLiked,this.indexedDB&&(this.isLiked?await this.indexedDB.addLike(this.gameId):await this.indexedDB.removeLike(this.gameId)),e.game){const t=document.getElementById("playerContainer");t&&(t.setAttribute("data-rating-avg",e.game.rating_avg||0),t.setAttribute("data-rating-count",e.game.rating_count||0),t.setAttribute("data-view-count",e.game.view_count||0),t.setAttribute("data-like-count",e.game.like_count||0)),N(),this.indexedDB&&await this.indexedDB.updateGames([e.game])}return this.updateLikeUI(),!0}}return!1}catch(t){return!1}},async toggleFavorite(t){if(!l||!l.isLogin())return alert("Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§."),!1;if(!this.gameId)return!1;try{const e=await n(`${API_BASE_URL}/api/games/${this.gameId}/favorite`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({action:t?"add":"remove"})});if(e.ok){if((await e.json()).success)return this.isFavorite=t,this.indexedDB&&(t?await this.indexedDB.addFavorite(this.gameId):await this.indexedDB.removeFavorite(this.gameId)),void 0!==F&&F.updateFavoriteState(this.isFavorite),!0}return!1}catch(t){return!1}},async incrementView(){if(!this.gameId)return!1;try{const t=await fetch(`${API_BASE_URL}/api/games/${this.gameId}/view`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include"});if(t.ok){if((await t.json()).success)return!0}return!1}catch(t){return!1}},updateRatingUI(){const t=document.getElementById("gameRatingOverall"),e=document.getElementById("gameRating"),n=document.getElementById("ratingButton"),i=document.getElementById("ratingButtonText"),o=document.getElementById("ratingPopupStars"),a=(document.getElementById("ratingPopup"),document.getElementById("gameViews")),s=document.getElementById("gameViewsCount");if(!(t||e||a||s))return;const r=document.getElementById("playerContainer");if(!r)return;const c=parseFloat(r.getAttribute("data-rating-avg"))||0,u=parseInt(r.getAttribute("data-rating-count"))||0,m=parseInt(r.getAttribute("data-view-count"))||0;if(t){d.renderStars(t,c);let e=t.querySelector(".rating-count");e||(e=document.createElement("span"),e.className="rating-count",t.appendChild(e)),e.textContent=`(${u})`,t.classList.add("readonly")}s&&(s.textContent=_(m)),a&&(a.setAttribute("data-raw-value",m.toString()),a.setAttribute("title",`${m.toLocaleString("ko-KR")} plays`));const h=l&&l.isLogin(),g=this.userRating||0,y=!!this.userRating;if(n&&(n.disabled=!h,n.classList.toggle("disabled",!h),n.setAttribute("aria-disabled",(!h).toString()),n.setAttribute("title",h?"Î≥ÑÏ†êÏùÑ ÎÇ®Í≤®Î≥¥ÏÑ∏Ïöî":"Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§.")),i&&(i.textContent=h?y?`${g.toFixed(1)}Ï†ê`:"Î≥ÑÏ†ê Ï£ºÍ∏∞":"Î°úÍ∑∏Ïù∏ ÌïÑÏöî"),o){const t=y?this.userRating:null;d.renderStars(o,g,t),void 0!==p&&p.position()}e&&e.classList.toggle("readonly",!h),h||void 0===p||p.close(),void 0!==p&&(p.init(),p.position()),h&&this.attachRatingClickHandlers()},updateLikeUI(){const t=document.getElementById("gameMetrics"),e=document.getElementById("playerContainer");if(!e)return;const n=parseInt(e.getAttribute("data-view-count"))||0,i=parseInt(e.getAttribute("data-like-count"))||0,o=document.getElementById("gameViews"),a=document.getElementById("gameViewsCount");a&&(a.textContent=_(n)),o&&(o.setAttribute("data-raw-value",n.toString()),o.setAttribute("title",`${n.toLocaleString("ko-KR")} plays`));const s=this.isLiked?"üíõ":"üñ§",r=`<span class="${this.isLiked?"metric-item liked":"metric-item"}" id="likeItem">${s} ${_(i)}</span>`;t&&(t.innerHTML=r);const c=document.getElementById("likeItem");c&&l&&l.isLogin()&&c.addEventListener("click",()=>{this.toggleLike()})},attachRatingClickHandlers(){const t=document.getElementById("ratingPopupStars");if(!t)return;t.querySelectorAll(".star").forEach((t,e)=>{t.onclick=n=>{n.stopPropagation();const i=parseInt(t.getAttribute("data-value"),10),o=Number.isFinite(i)?i:e+1;this.setRating(o),void 0!==p&&p.close()}})}},document.addEventListener("DOMContentLoaded",function(){I();const t=document.getElementById("playerContainer");if(t){const e=t.getAttribute("data-game-id");e&&window.gameAPI&&window.gameAPI.init(e)}N(),void 0!==p&&p.init();const e=document.getElementById("gameMenuButton");if(e&&void 0!==F){const t=document.getElementById("playerContainer");if(t){const n=t.getAttribute("data-game-id"),i=!!window.gameAPI&&window.gameAPI.isFavorite;n&&(F.createMenu(n,i),e.addEventListener("click",t=>{t.stopPropagation(),F.isOpen?F.hide():F.show(e)}))}}f>=768&&!k()?A("landscape"):A("normal"),function(t,e,n){const i=window.matchMedia("(max-width: 768px)"),o=window.matchMedia("(min-width: 769px) and (max-width: 1024px)"),a=window.matchMedia("(min-width: 1025px)");function s(){i.matches?t():o.matches?e():a.matches&&n()}function r(){s()}s(),i.addEventListener("change",r),o.addEventListener("change",r),a.addEventListener("change",r)}(function(){const t=document.querySelector(".game-info");t&&"none"===t.style.display&&A("normal");const e=document.getElementById("normalBtn");e&&(e.style.display="none")},function(){const t=document.getElementById("normalBtn");t&&(t.style.display="flex")},function(){const t=document.getElementById("normalBtn");t&&(t.style.display="flex")});const n="{{category}}";if(n){const t=document.querySelector(`a[href="/index.html?cat=${n}"]`);t&&t.classList.add("active")}!function(){const t=document.getElementById("playerContainer");if(!t)return;const e={name:t.getAttribute("data-name"),thumbnail:t.getAttribute("data-thumbnail"),url:window.location.href,category:t.getAttribute("data-category")||"",timestamp:Date.now()},n=JSON.parse(localStorage.getItem("recentlyVisited")||"[]"),i=n.findIndex(t=>t.url===e.url);-1!==i&&n.splice(i,1),n.unshift(e),n.length>30&&n.splice(30),localStorage.setItem("recentlyVisited",JSON.stringify(n))}(),function(){const t=document.getElementById("keyboardToggleBtn"),e=document.getElementById("virtualKeyboard");if(!t||!e)return;t.addEventListener("click",function(){e.classList.contains("active")?P():C()})}(),function(){const t=document.querySelectorAll(".game-info-tab"),e=document.querySelectorAll(".game-info-tab-content");t.forEach(n=>{n.addEventListener("click",function(){const n=this.getAttribute("data-tab");t.forEach(t=>t.classList.remove("active")),e.forEach(t=>t.classList.remove("active")),this.classList.add("active");const i=document.getElementById(`tab${n.charAt(0).toUpperCase()+n.slice(1)}`);i&&i.classList.add("active")})})}(),function(){if(!document.getElementById("commentsContainer"))return;let t=0;const e=10;function n(){void 0!==window.GAME_COMMENTS?D(window.GAME_COMMENTS):t<e?(t++,setTimeout(n,100)):D([])}n()}();document.querySelectorAll(".header, .playerContainer").forEach((t,e)=>{t.style.opacity="0",t.style.transform="translateY(30px)",setTimeout(()=>{t.style.transition="opacity 0.5s ease, transform 0.5s ease",t.style.opacity="1",t.style.transform="translateY(0)"},200*e)})});const K="popupGameMenuStyles";const F=new class{constructor(){this.menu=null,this.isOpen=!1,this.currentGameId=null,this.isFavorite=!1,this.initStyles()}initStyles(){const e="\n.game-popup {\n  position: fixed;\n  top: 0;\n  left: 0;\n  opacity: 0;\n  pointer-events: none;\n  z-index: 11000;\n  background: #f2b32b;\n  border: 1px solid #a64a1f;\n  border-radius: 12px;\n  box-shadow: 0 8px 20px rgba(0,0,0,0.15);\n  padding: 14px;\n  min-width: 200px;\n  max-width: min(280px, calc(100vw - 32px));\n  transform: translate(-50%, -8px);\n  transition: opacity 0.2s ease, transform 0.2s ease;\n  will-change: top, left, transform;\n}\n.game-popup.show {\n  opacity: 1;\n  pointer-events: auto;\n  transform: translate(-50%, 0);\n}\n.game-popup::after {\n  content: '';\n  position: absolute;\n  left: 50%;\n  transform: translateX(-50%);\n  border-width: 8px;\n  border-style: solid;\n  border-color: transparent;\n  display: none;\n}\n.game-popup.above::after,\n.game-popup.below::after {\n  display: block;\n}\n.game-popup.above::after {\n  top: 100%;\n  border-top-color: #f2b32b;\n}\n.game-popup.below::after {\n  bottom: 100%;\n  border-bottom-color: #f2b32b;\n}\n.game-popup-content {\n  display: flex;\n  flex-direction: column;\n  gap: 10px;\n}\n.game-popup-title {\n  font-size: 0.9rem;\n  font-weight: 600;\n  color: #000;\n}\n.popup-menu-item {\n  display: flex;\n  align-items: center;\n  gap: 12px;\n  padding: 10px 16px;\n  cursor: pointer;\n  transition: background 0.2s ease;\n  font-size: 0.9rem;\n  font-weight: 600;\n  color: #000;\n  border-radius: 8px;\n}\n.popup-menu-item:hover {\n  background: #ffaa00;\n}\n.popup-menu-icon {\n  font-size: 1.2rem;\n  width: 20px;\n  text-align: center;\n}\n.popup-menu-text {\n  flex: 1;\n}\n";t(K,e)}createMenu(t,e=!1){this.currentGameId=t,this.isFavorite=e,this.menu&&this.menu.remove(),this.menu=document.createElement("div"),this.menu.className="game-popup",this.menu.innerHTML=`\n            <div class="game-popup-content">\n                <div class="popup-menu-item" id="favoriteMenuItem">\n                    <span class="popup-menu-icon">${e?"‚≠ê":"‚òÜ"}</span>\n                    <span class="popup-menu-text">${e?"Ï¶êÍ≤®Ï∞æÍ∏∞ Ï†úÍ±∞":"Ï¶êÍ≤®Ï∞æÍ∏∞ Ï∂îÍ∞Ä"}</span>\n                </div>\n            </div>\n        `,document.body.appendChild(this.menu);const n=this.menu.querySelector("#favoriteMenuItem");n&&n.addEventListener("click",()=>{this.toggleFavorite()}),document.addEventListener("click",this.handleOutsideClick.bind(this))}show(t){if(!this.menu)return;const e=t.getBoundingClientRect();this.menu.style.top=`${e.bottom+5}px`,this.menu.style.right=window.innerWidth-e.right+"px",this.menu.classList.add("show"),this.isOpen=!0}hide(){this.menu&&(this.menu.classList.remove("show"),this.isOpen=!1)}handleOutsideClick(t){if(this.menu&&this.isOpen&&!this.menu.contains(t.target)){const e=document.getElementById("gameMenuButton");e&&!e.contains(t.target)&&this.hide()}}async toggleFavorite(){if(this.currentGameId)try{const t=!this.isFavorite;await window.gameAPI.toggleFavorite(t)?(this.isFavorite=t,this.updateFavoriteMenuItem(),this.hide()):alert("Ï¶êÍ≤®Ï∞æÍ∏∞ ÏóÖÎç∞Ïù¥Ìä∏Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.")}catch(t){alert("Ï¶êÍ≤®Ï∞æÍ∏∞ ÏóÖÎç∞Ïù¥Ìä∏Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.")}}updateFavoriteMenuItem(){const t=this.menu.querySelector("#favoriteMenuItem");if(t){const e=t.querySelector(".popup-menu-icon"),n=t.querySelector(".popup-menu-text");e&&(e.textContent=this.isFavorite?"‚≠ê":"‚òÜ"),n&&(n.textContent=this.isFavorite?"Ï¶êÍ≤®Ï∞æÍ∏∞ Ï†úÍ±∞":"Ï¶êÍ≤®Ï∞æÍ∏∞ Ï∂îÍ∞Ä")}}updateFavoriteState(t){this.isFavorite=t,this.menu&&this.updateFavoriteMenuItem()}};!function(){function t(){const t=document.getElementById("languageSelect");if(!t)return;const e={en:"English",ko:"ÌïúÍµ≠Ïñ¥",ja:"Êó•Êú¨Ë™û"};let n=[];const i=t.dataset.availableLangs?t.dataset.availableLangs.split(",").map(t=>t.trim()).filter(Boolean):[];if(i.length)n=i;else if("undefined"!=typeof AVAILABLE_LANGS&&Array.isArray(AVAILABLE_LANGS))n=AVAILABLE_LANGS.filter(Boolean);else if("undefined"!=typeof window&&window.AVAILABLE_LANGS){const t=window.AVAILABLE_LANGS;n=Array.isArray(t)?t.filter(Boolean):[]}n.length||(n=["en"]),n.includes("en")||n.unshift("en");const o=Array.from(new Set(n)),a=t.dataset.currentLang||("undefined"!=typeof CURRENT_LANG&&CURRENT_LANG?CURRENT_LANG:"en"),s=t.dataset.rootPath||("undefined"!=typeof ROOT_PATH?ROOT_PATH:"");t.innerHTML=o.map(t=>{const n=e[t]||t.toUpperCase();return`<option value="${t}">${n}</option>`}).join(""),o.includes(a)&&(t.value=a),t.addEventListener("change",t=>{const e=t.target.value||"en",n="undefined"!=typeof window&&window.isTestMode||!1?"index.html":"index";let i;i=e&&"en"!==e?s?`${s}/${e}/${n}`:`/${e}/${n}`:s?`${s}/${n}`:`/${n}`,window.location.href=i}),t.addEventListener("mousedown",t=>t.stopPropagation()),t.addEventListener("touchstart",t=>t.stopPropagation()),t.addEventListener("click",t=>t.stopPropagation())}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",t,{once:!0}):t();const e="moly_search_history";function n(){try{const t=localStorage.getItem(e);return t?JSON.parse(t):[]}catch(t){return[]}}function i(t){try{localStorage.setItem(e,JSON.stringify(t))}catch(t){}}function o(t){if(!t||""===t.trim())return;let e=n();const o=t.trim();e=e.filter(t=>t.toLowerCase()!==o.toLowerCase()),e.unshift(o),e.length>30&&(e=e.slice(0,30)),i(e),a()}function a(){const t=document.getElementById("searchHistoryList"),e=n();0!==e.length?(t.innerHTML=e.map((t,e)=>`\n            <li class="search-history-item" data-index="${e}">\n                <span class="search-history-text">${function(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}(t)}</span>\n                <button class="search-history-delete" data-index="${e}" aria-label="ÏÇ≠Ï†ú">\n                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="16" height="16">\n                        <line x1="18" y1="6" x2="6" y2="18"></line>\n                        <line x1="6" y1="6" x2="18" y2="18"></line>\n                    </svg>\n                </button>\n            </li>\n        `).join(""),document.querySelectorAll(".search-history-item").forEach(t=>{t.querySelector(".search-history-text").addEventListener("click",function(){s(e[parseInt(t.dataset.index)])})}),document.querySelectorAll(".search-history-delete").forEach(t=>{t.addEventListener("click",function(t){t.stopPropagation();!function(t){let e=n();e.splice(t,1),i(e),a()}(parseInt(this.dataset.index))})})):t.innerHTML='<li class="search-history-empty">Í≤ÄÏÉâ Í∏∞Î°ùÏù¥ ÏóÜÏäµÎãàÎã§</li>'}function s(t){const e=document.getElementById("searchBox");e&&(e.value=t,"function"==typeof filterGamesBySearch&&filterGamesBySearch(t));const n=document.getElementById("searchModalInput");n&&(n.value=t),o(t),"function"==typeof filterGamesBySearch&&filterGamesBySearch(t),m()}const r=document.getElementById("searchIconButton"),c=document.getElementById("searchModal"),d=document.getElementById("searchModalClose"),l=document.getElementById("searchModalInput"),u=document.getElementById("searchHistoryClear");function m(){if(c&&r){c.classList.remove("active"),r.style.position="",r.style.top="",r.style.right="";const t=document.querySelector(".search-modal-header");t&&(t.style.paddingTop=""),document.body.classList.remove("modal-open")}}r&&r.addEventListener("click",function(){c&&c.classList.contains("active")?m():function(){if(c&&r){document.body.classList.add("modal-open");const t=r.getBoundingClientRect(),e=t.top,n=window.innerWidth-t.right,i=e+t.height/2;r.style.position="fixed",r.style.top=e+"px",r.style.right=n+"px",r.style.zIndex="2001",c.classList.add("active");const o=document.querySelector(".search-modal-header"),s=document.getElementById("searchModalInput");if(o&&s){const t=s.offsetHeight||40;o.style.paddingTop=i-t/2+"px"}l&&l.focus(),a()}}()}),d&&d.addEventListener("click",m),l&&l.addEventListener("keypress",function(t){if("Enter"===t.key){s(this.value)}}),u&&u.addEventListener("click",function(){confirm("Í≤ÄÏÉâ Í∏∞Î°ùÏùÑ Î™®Îëê ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?")&&(i([]),a())}),c&&c.addEventListener("click",function(t){t.target===c&&m()});const h=document.getElementById("searchBox");h&&h.addEventListener("keypress",function(t){if("Enter"===t.key){const t=this.value;o(t),"function"==typeof filterGamesBySearch&&filterGamesBySearch(t)}})}(),document.addEventListener("DOMContentLoaded",function(){if(void 0!==l&&l.isLogin()){const t=l.get(),e=document.getElementById("google-login-button"),n=document.querySelector(".user-menu"),i=document.getElementById("userAvatar"),o=document.getElementById("userName"),a=document.getElementById("userEmail");e&&(e.style.display="none"),n&&(n.style.display="flex",n.classList.add("show")),i&&t.picture&&(i.src=t.picture,i.alt=t.nickname||t.name||"User"),o&&(o.textContent=t.nickname||t.name||"User"),a&&(a.textContent=t.email||"")}const t=document.getElementById("logoutItem");t&&t.addEventListener("click",function(){confirm("Î°úÍ∑∏ÏïÑÏõÉ ÌïòÏãúÍ≤†ÏäµÎãàÍπå?")&&void 0!==l&&l.logout()})}),function(){const t=document.getElementById("bottomLoginButton"),e=document.getElementById("loginButton");t&&e&&t.addEventListener("click",function(){e.onclick?e.onclick():e.click()});const n=document.getElementById("bottomFavorites");n&&n.addEventListener("click",function(){alert("Favorites Í∏∞Îä•")});const i=document.getElementById("bottomRecentlyVisited");i&&i.addEventListener("click",function(){alert("Recently Visited Í∏∞Îä•")});const o=window.location.pathname,a=document.getElementById("bottomHome");(o.includes("index.html")||o.includes("index")||"/"===o||o.endsWith("/"))&&a&&a.classList.add("active")}()})();</script><style>.top-toolbar{background:#f7bd36;grid-area:topbar;position:sticky;top:0;z-index:1000}.top-toolbar-container{display:grid;grid-template-columns:auto 1fr auto;align-items:center;padding:0;height:60px;gap:20px}.logo{flex-shrink:0;padding-left:20px;font-weight:700}.logo a{color:#fff;text-decoration:none;font-size:1.1rem;font-weight:700;text-shadow:0 0 5px #000;transition:opacity .3s;display:flex;align-items:center;position:relative}.logo a:hover{opacity:.9}.logo img{height:48px;width:auto;object-fit:contain}.logo a span{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);pointer-events:none}.top-toolbar-right{display:flex;align-items:center;justify-content:flex-end;gap:20px;padding-right:20px}.search-container{display:flex;justify-content:center;align-items:center;width:100%;position:relative}.search-wrapper{position:relative;width:100%;max-width:500px}.search-icon{position:absolute;left:15px;top:50%;transform:translateY(-50%);width:20px;height:20px;pointer-events:none;transition:stroke .3s;stroke:#a64a1f}.search-box{width:100%;padding:10px 20px 10px 50px;border:1px solid #a64a1f!important;border-radius:25px;background:#f2b32b!important;color:#000!important;font-size:1rem;outline:0;transition:.3s}.search-box::placeholder{color:#00000088}.search-box:focus{border-color:#a64a1f!important;box-shadow:0 0 0 3px rgba(255,255,255,.2);background:#ffb516!important;color:#000!important}.search-wrapper:focus-within .search-icon{stroke:#a64a1f}.search-icon-button{display:none;width:40px;height:40px;border-radius:50%;background:#ffb516!important;color:#a64a1f;border:1px solid #a64a1f!important;cursor:pointer;align-items:center;justify-content:center;transition:.3s;flex-shrink:0;position:relative;z-index:2001}.search-icon-button:hover{background:#fa0!important;transform:scale(1.1)}.search-icon-button svg{width:20px;height:20px;stroke:#a64a1f;stroke-width:2}.search-modal{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:#f7bd36;z-index:2000;flex-direction:column;padding:0;overflow-y:auto}.search-modal.active{display:flex}.search-modal-header{display:flex;align-items:center;gap:15px;padding:20px;margin-bottom:20px;position:relative;max-width:100%}.search-modal-input-wrapper{flex:1;position:relative;max-width:500px;margin:0 auto;width:100%}body.modal-open{overflow:hidden}.search-modal-input{width:100%;padding:10px 20px 10px 50px;border:1px solid #fff!important;border-radius:25px;background:#ffb516!important;color:#000!important;font-size:1rem;outline:0;transition:.3s}.search-modal-input::placeholder{color:rgba(255,255,255,.7)}.search-modal-input:focus{border-color:#a64a1f!important;box-shadow:0 0 0 3px rgba(255,255,255,.2);background:#fa0!important;color:#000!important}.search-modal-input-icon{position:absolute;left:15px;top:50%;transform:translateY(-50%);width:20px;height:20px;pointer-events:none;transition:stroke .3s;stroke:#a64a1f;stroke-width:2}.search-modal-input-wrapper:focus-within .search-modal-input-icon{stroke:#a64a1f}.search-modal-close{width:40px;height:40px;border-radius:50%;background:#000;color:#f7bd36;border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:.3s;flex-shrink:0;margin-left:10px}.search-modal-close:hover{background:#333;transform:scale(1.1)}.search-modal-close svg{width:20px;height:20px;stroke:#f7bd36;stroke-width:2}.search-history-section{margin-top:0;padding:0 20px 20px}.search-history-title{font-size:1rem;font-weight:700;color:#000;margin-bottom:15px;display:flex;align-items:center;justify-content:space-between}.search-history-clear{background:0 0;border:none;color:rgba(0,0,0,.6);font-size:.85rem;cursor:pointer;padding:5px 10px;border-radius:8px;transition:.3s}.search-history-clear:hover{background:rgba(0,0,0,.1);color:#000}.search-history-list{list-style:none;padding:0;margin:0}.search-history-item{padding:15px;background:#a64a1f;border-radius:10px;margin-bottom:10px;cursor:pointer;transition:.3s;display:flex;align-items:center;justify-content:space-between;gap:10px}.search-history-item:hover{background:rgba(0,0,0,.05);transform:translateX(5px)}.search-history-text{flex:1;color:#000;font-size:1rem;display:flex;align-items:center;gap:10px}.search-history-text::before{content:'üïí';font-size:.9rem}.search-history-delete{background:0 0;border:none;color:rgba(0,0,0,.4);cursor:pointer;padding:5px;border-radius:5px;transition:.3s;display:flex;align-items:center;justify-content:center}.search-history-delete:hover{background:rgba(0,0,0,.1);color:#000}.search-history-empty{text-align:center;padding:40px 20px;color:rgba(0,0,0,.5);font-size:.9rem}#google-login-button{flex-shrink:0}.user-menu{display:none;align-items:center;gap:10px;position:relative}.user-menu.show{display:flex}.user-button{display:flex;align-items:center;gap:10px;background:0 0;border:none;cursor:pointer;padding:5px;border-radius:50%;transition:.3s}.user-button:hover{background:rgba(0,0,0,.1)}.user-avatar{width:40px;height:40px;border-radius:50%;object-fit:cover;border:1px solid #a64a1f}.user-dropdown{position:absolute;top:50px;right:0;background:#f7bd36;border:2px solid #000;border-radius:10px;box-shadow:0 4px 12px rgba(0,0,0,.15);min-width:200px;display:none;z-index:1000}.user-dropdown.show{display:block}.user-dropdown-item{padding:15px 20px;cursor:pointer;transition:background .2s;border-bottom:1px solid rgba(0,0,0,.1)}.user-dropdown-item:last-child{border-bottom:none}.user-dropdown-item:hover{background:rgba(0,0,0,.05)}.user-dropdown-item.logout{color:#e74c3c;font-weight:600}.user-dropdown-item.language-select-item{display:flex;flex-direction:column;gap:6px}.language-select-label{font-size:.85rem;font-weight:600;color:rgba(0,0,0,.7)}.language-select{width:100%;padding:6px 10px;border:1px solid rgba(0,0,0,.2);border-radius:8px;background:#fff;color:#000;font-size:.9rem}.nickname-modal{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.5);z-index:3000;align-items:center;justify-content:center}.nickname-modal:not(.hidden){display:flex}.nickname-modal-content{background:#f7bd36;padding:30px;border-radius:15px;border:3px solid #000;max-width:500px;width:90%;box-shadow:0 10px 30px rgba(0,0,0,.3)}.nickname-modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}.nickname-modal-title{font-size:1.5rem;font-weight:700;color:#000}.close-nickname-modal{background:0 0;border:none;font-size:1.5rem;cursor:pointer;color:#000;padding:0;width:30px;height:30px;display:flex;align-items:center;justify-content:center;border-radius:50%;transition:background .2s}.close-nickname-modal:hover{background:rgba(0,0,0,.1)}.nickname-input-wrapper{margin-bottom:15px}.nickname-input{width:100%;padding:12px 15px;border:2px solid rgba(0,0,0,.3);border-radius:10px;background:#fff;font-size:1rem;outline:0;transition:border-color .3s}.nickname-input:focus{border-color:#000}.nickname-error{color:#e74c3c;font-size:.9rem;margin-top:5px;display:none}.nickname-error:not(.hidden){display:block}.nickname-modal-actions{display:flex;gap:10px;justify-content:flex-end}.nickname-modal-btn{padding:10px 20px;border:2px solid #000;border-radius:8px;font-size:1rem;font-weight:600;cursor:pointer;transition:.3s}.nickname-modal-btn.confirm{background:#000;color:#f7bd36}.nickname-modal-btn.confirm:hover{background:#333}.nickname-modal-btn.cancel{background:0 0;color:#000}.nickname-modal-btn.cancel:hover{background:rgba(0,0,0,.1)}@media (max-width:900px){.search-wrapper,.user-menu{display:none}.search-icon-button{display:flex}.search-container{justify-content:flex-end}}</style><nav class="top-toolbar"><div class="top-toolbar-container"><div class="logo"><a href="https://www.moly.win/ja/index"><img src="https://www.moly.win/logo.webp" alt="Moly.win"></a></div><div class="search-container"><div class="search-wrapper"><input class="search-box" id="searchBox" placeholder="Í≤ÄÏÉâÏñ¥Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî..."> <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><path d="M21 21l-4.35-4.35"></path></svg></div></div><div class="top-toolbar-right"><button class="search-icon-button" id="searchIconButton"><svg viewBox="0 0 24 24" fill="none" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><path d="M21 21l-4.35-4.35"></path></svg></button><div id="google-login-button"></div><div class="user-menu"><button class="user-button" id="userButton"><img src="" alt="User" class="user-avatar" id="userAvatar"></button><div class="user-dropdown" id="userDropdown"><div class="user-dropdown-item" id="userInfo"><div style="font-weight: 600; margin-bottom: 5px;" id="userName"></div><div style="font-size: 0.85rem; color: rgba(0,0,0,0.6);" id="userEmail"></div></div><div class="user-dropdown-item language-select-item" id="languageItem"><label class="language-select-label" for="languageSelect">Language</label> <select id="languageSelect" class="language-select" data-available-langs="en,ko,ja" data-current-lang="ja" data-root-path="https://www.moly.win"></select></div><div class="user-dropdown-item logout" id="logoutItem">Î°úÍ∑∏ÏïÑÏõÉ</div></div></div></div></div></nav><div class="nickname-modal hidden" id="nickname-modal"><div class="nickname-modal-content"><div class="nickname-modal-header"><h3 class="nickname-modal-title">ÎãâÎÑ§ÏûÑ ÏÑ§Ï†ï</h3><button class="close-nickname-modal" id="closeNicknameModal">√ó</button></div><div class="nickname-input-wrapper"><input class="nickname-input" id="nickname-input" placeholder="ÎãâÎÑ§ÏûÑÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî (2-20Ïûê)" maxlength="20"><div class="nickname-error hidden" id="nickname-error"></div></div><div class="nickname-modal-actions"><button class="nickname-modal-btn cancel" id="cancel-nickname">Ï∑®ÏÜå</button> <button class="nickname-modal-btn confirm" id="confirm-nickname">ÌôïÏù∏</button></div></div></div><div class="search-modal" id="searchModal"><div class="search-modal-header"><div class="search-modal-input-wrapper"><input class="search-modal-input" id="searchModalInput" placeholder="Í≤ÄÏÉâÏñ¥Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî..."> <svg class="search-modal-input-icon" viewBox="0 0 24 24" fill="none" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><path d="M21 21l-4.35-4.35"></path></svg></div><button class="search-modal-close" id="searchModalClose"><svg viewBox="0 0 24 24" fill="none" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg></button></div><div class="search-history-section"><div class="search-history-title"><span>Í≤ÄÏÉâ Í∏∞Î°ù</span> <button class="search-history-clear" id="searchHistoryClear">Ï†ÑÏ≤¥ ÏÇ≠Ï†ú</button></div><ul class="search-history-list" id="searchHistoryList"></ul></div></div><script src="https://accounts.google.com/gsi/client" async="" defer=""></script><style>.bottom-toolbar{background:#f7bd36;position:fixed;bottom:0;left:0;right:0;z-index:1000;border-top:1px solid #a64a1f;box-shadow:0 0 4px #a64a1f;display:none}.bottom-toolbar-container{display:flex;justify-content:space-around;align-items:center;padding:10px 0;max-width:100%;height:60px}.bottom-toolbar-item{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:4px;flex:1;padding:8px;cursor:pointer;transition:.3s;border:none;background:0 0;color:#000;text-decoration:none;font-size:.75rem}.bottom-toolbar-item:hover{background:rgba(0,0,0,.1);border-radius:8px}.bottom-toolbar-item.active{background:rgba(0,0,0,.15);border-radius:8px}.bottom-toolbar-icon{width:24px;height:24px;stroke:black;stroke-width:2;fill:none;filter:drop-shadow(0px 0px 2px white)}.bottom-toolbar-item svg{width:24px;height:24px;filter:drop-shadow(0px 0px 2px white)}.bottom-toolbar-label{font-size:.7rem;font-weight:700;color:#000;text-shadow:0 0 2px #fff}@media (max-width:900px){.bottom-toolbar{display:block}}</style><nav class="bottom-toolbar" id="bottomToolbar"><div class="bottom-toolbar-container"><a href="https://www.moly.win/ja/index" class="bottom-toolbar-item" id="bottomHome"><svg class="bottom-toolbar-icon" viewBox="0 0 24 24" fill="none" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg> <span class="bottom-toolbar-label">Home</span> </a><button class="bottom-toolbar-item" id="bottomFavorites"><svg class="bottom-toolbar-icon" viewBox="0 0 24 24" fill="none" stroke-linecap="round" stroke-linejoin="round"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg> <span class="bottom-toolbar-label">Favorites</span></button> <button class="bottom-toolbar-item" id="bottomRecentlyVisited"><svg class="bottom-toolbar-icon" viewBox="0 0 24 24" fill="none" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg> <span class="bottom-toolbar-label">Recent</span></button> <button class="bottom-toolbar-item" id="bottomLoginButton"><svg class="bottom-toolbar-icon" viewBox="0 0 24 24" fill="none" stroke-linecap="round" stroke-linejoin="round"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"></path><polyline points="10 17 15 12 10 7"></polyline><line x1="15" y1="12" x2="3" y2="12"></line></svg> <span class="bottom-toolbar-label">Login</span></button></div></nav><div class="container"><div class="main-content"><div class="playerContainer" id="playerContainer" data-game-id="Ludum" data-thumbnail="https://www.moly.win/games/Logic/ludum/thumbnail.jpg" data-name="Ludum" data-game-url="https://www.moly.win/games/Logic/ludum/index.html" data-resolution="1024*786" data-left-keys="[&quot;ArrowLeft&quot;,&quot;ArrowUp&quot;,&quot;ArrowDown&quot;,&quot;ArrowRight&quot;]" data-right-keys="[&quot;W&quot;,&quot;A&quot;,&quot;S&quot;,&quot;D&quot;,&quot;Space&quot;,&quot;Enter&quot;,&quot;Escape&quot;]" data-rating-avg="0" data-rating-count="0" data-view-count="0" data-like-count="0"></div><div class="game-info"><style>.game-info{background:#f7bd36;border-radius:15px;padding:20px;box-shadow:0 10px 30px rgba(0,0,0,.2);flex:1;overflow-y:auto;display:flex;flex-direction:column}.game-info-tabs{display:flex;gap:10px;margin-bottom:20px;border-bottom:2px solid rgba(0,0,0,.1)}.game-meta{display:flex;flex-direction:row;align-items:center;gap:8px;margin-top:0}.game-views{display:inline-flex;align-items:center;gap:3px;background:rgba(0,0,0,.08);color:#5b3100;padding:2px 6px;border-radius:4px;font-size:.65rem;font-weight:600;letter-spacing:.03em}.game-views-count{font-weight:600;color:#5b3100}.game-views-label{color:#5b3100;margin-left:0}.game-category-badge{display:inline-flex;align-items:center;gap:3px;background:rgba(0,0,0,.08);color:#5b3100;padding:2px 6px;border-radius:4px;font-size:.65rem;font-weight:600;letter-spacing:.03em;text-transform:uppercase}.game-header{margin-bottom:20px;position:relative;display:flex;flex-direction:column;gap:16px}.game-header-top{display:flex;justify-content:space-between;align-items:flex-start;gap:16px;flex-wrap:wrap;position:relative}.game-title-row{display:flex;flex-direction:row;align-items:center;gap:12px;flex:1;padding-right:40px;flex-wrap:wrap}.game-header-bottom{display:flex;justify-content:space-between;align-items:flex-start;gap:20px;flex-wrap:wrap}.game-summary-section{flex:1 1 60%}.game-summary-section .game-summary{margin:0}.game-rating-overall{display:inline-flex;align-items:center;gap:3px;background:rgba(0,0,0,.08);color:#5b3100;padding:2px 6px;border-radius:4px;font-size:.65rem;font-weight:600;letter-spacing:.03em;white-space:nowrap;flex:0 0 auto;margin-left:auto}.game-menu-button{position:absolute;top:-4px;right:0;background:0 0;border:none;cursor:pointer;padding:8px;display:flex;align-items:center;justify-content:center;border-radius:50%;transition:background .2s;width:36px;height:36px;flex-shrink:0}.game-menu-button:hover{background:rgba(0,0,0,.1)}.game-menu-button svg{width:20px;height:20px;stroke:#333;stroke-width:2;fill:none}.game-description{font-size:1.1rem;line-height:1.6;color:#555;margin-bottom:20px}.game-instructions{background:#f2b32b;padding:20px;border-radius:10px;border-left:4px solid #a64a1f}.game-instructions h3{color:#333;margin-bottom:10px;font-size:1.2rem}.game-instructions p{color:#666;line-height:1.5}.game-summary{font-size:.95rem;color:#333;margin:15px 0;line-height:1.5}.game-user-stats{display:flex;justify-content:space-between;align-items:center;margin:15px 0;gap:12px;flex-wrap:wrap}.game-user-rating{display:flex;align-items:center;gap:12px;flex-wrap:wrap}.game-rating{display:flex;gap:2px;align-items:center}.game-rating-user,.game-rating.readonly{cursor:default}.rating-control{position:relative;display:inline-flex;align-items:center}.rating-button{background:#f2b32b;color:#000;border:1px solid #a64a1f;padding:8px 16px;border-radius:16px;font-size:.85rem;font-weight:600;cursor:pointer;transition:background .3s;display:inline-flex;align-items:center;gap:6px;height:38px;box-sizing:border-box}.rating-button:hover:not(.disabled){background:#fa0}.rating-button.disabled{cursor:not-allowed;opacity:.65}.rating-button-icon{font-size:1rem}.rating-count{color:#666;font-size:.85rem;font-weight:500}.game-rating:not(.readonly) .star:hover{transform:scale(1.2)}.game-metrics{display:flex;align-items:center}.game-metrics-text{display:flex;align-items:center;gap:12px;font-size:.9rem;color:#333;white-space:nowrap}.metric-item{background:#f2b32b;color:#000;border:1px solid #a64a1f;padding:8px 16px;border-radius:16px;font-size:.85rem;font-weight:600;cursor:pointer;transition:background .3s;display:inline-flex;align-items:center;gap:6px;height:38px;box-sizing:border-box}.metric-item:hover{background:#fa0}.metric-item.liked{background:#e74c3c;border-color:#c0392b;color:#fff}.metric-item.liked:hover{background:#c0392b}.metric-item-icon{font-size:1rem}@media (max-width:900px){.game-info{flex:none;height:auto;min-height:auto;margin-top:10px;order:2;overflow:visible}.game-meta{width:100%;justify-content:flex-start;gap:8px}}</style><div class="game-header"><div class="game-header-top"><div class="game-title-row"><h1 class="game-title">Ludum</h1><div class="game-meta"><span class="game-views" id="gameViews" data-raw-value="0" title="0 plays"><span class="game-views-count" id="gameViewsCount">0</span> <span class="game-views-label">plays</span> </span><span class="game-category-badge">Logic</span></div></div><button class="game-menu-button" id="gameMenuButton" title="Î©îÎâ¥"><svg viewBox="0 0 24 24" fill="none" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="5" r="1"></circle><circle cx="12" cy="12" r="1"></circle><circle cx="12" cy="19" r="1"></circle></svg></button></div><div class="game-header-bottom"><div class="game-summary-section"><div class="game-summary">Chess is a two-player</div></div><div class="game-rating game-rating-overall readonly" id="gameRatingOverall"></div></div></div><div class="game-user-stats"><div class="game-user-rating"><div class="game-rating game-rating-user" id="gameRating"><div class="rating-control"><button class="rating-button disabled" id="ratingButton" type="button" disabled=""><span class="rating-button-icon">‚òÖ</span> <span class="rating-button-text" id="ratingButtonText">Î≥ÑÏ†ê Ï£ºÍ∏∞</span></button><div class="rating-popup" id="ratingPopup"><div class="rating-popup-content"><div class="rating-popup-title">Î≥ÑÏ†êÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</div><div class="rating-popup-row"><div class="rating-popup-stars" id="ratingPopupStars"></div><button class="rating-confirm-button" id="ratingConfirmButton" type="button" disabled="">ÌôïÏù∏</button></div></div></div></div></div></div><div class="game-metrics"><span class="game-metrics-text" id="gameMetrics"></span></div></div><div class="game-info-tabs"><button class="game-info-tab active" data-tab="info">Í≤åÏûÑ Ï†ïÎ≥¥</button> <button class="game-info-tab" data-tab="comments">ÎåìÍ∏Ä</button></div><div class="game-info-tab-content active" id="tabInfo"><div class="game-description">A classic arcade-style shooter where the player controls a spaceship and must defeat waves of incoming aliens.</div><div class="game-instructions"><h3>üéÆ Í≤åÏûÑ Ï°∞ÏûëÎ≤ï</h3><p>Indie Studio XYZ</p></div></div><div class="game-info-tab-content" id="tabComments"><div class="comments-container" id="commentsContainer"></div></div></div></div></div><style>.virtual-keyboard-wrapper{position:fixed;bottom:0;left:0;right:0;z-index:10000;display:none}.virtual-keyboard-wrapper.active{display:block}.virtual-keyboard{background:#d1d4db;padding:4px;border-top:1px solid rgba(0,0,0,.1);box-shadow:0 -4px 30px rgba(0,0,0,.3);backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px)}.keyboard-close-btn{position:absolute;top:0;right:4px;width:32px;height:32px;background:linear-gradient(to bottom,#ff3b30 0,#d32f2f 100%);color:#fff;border:none;border-radius:6px;font-size:18px;font-weight:700;cursor:pointer;display:flex;align-items:center;justify-content:center;z-index:10001;box-shadow:0 2px 4px rgba(0,0,0,.3),inset 0 1px 0 rgba(255,255,255,.3),inset 0 -1px 0 rgba(0,0,0,.2);transition:.1s;user-select:none;-webkit-user-select:none;touch-action:manipulation}.keyboard-close-btn:hover{background:linear-gradient(to bottom,#ff5757 0,#e53935 100%);transform:scale(1.05)}.keyboard-close-btn:active{transform:scale(.95);box-shadow:0 1px 2px rgba(0,0,0,.3),inset 0 2px 4px rgba(0,0,0,.3)}.keyboard-container{position:relative;display:flex;gap:8px;max-width:100%;padding:0 4px;align-items:flex-start}.keyboard-left{position:relative;width:192px;height:147px;flex-shrink:0;cursor:pointer;border-radius:8px;transition:background .1s;user-select:none;-webkit-user-select:none}.keyboard-right{display:flex;flex-direction:row-reverse;flex-wrap:wrap-reverse;gap:6px;position:absolute;top:51px;left:195px;width:calc(100% - 195px);height:96px}.keyboard-left .keyboard-key{width:45px;height:45px;min-width:45px;min-height:45px;position:absolute;pointer-events:none}.keyboard-left .keyboard-key[data-key=ArrowUp]{left:49px;top:0}.keyboard-left .keyboard-key[data-key=ArrowDown]{left:49px;bottom:0;top:auto}.keyboard-left .keyboard-key[data-key=ArrowLeft]{left:0;top:50%;transform:translateY(-50%)}.keyboard-left .keyboard-key[data-key=ArrowRight]{left:98px;top:50%;transform:translateY(-50%)}.keyboard-right .keyboard-key{width:45px;height:45px;min-width:45px;min-height:45px;max-width:45px;max-height:45px}.keyboard-key{width:45px;height:45px;min-width:45px;min-height:45px;background:linear-gradient(to bottom,#fff 0,#e8e8e8 100%);color:#1c1c1e;border:none;border-radius:8px;font-size:14px;font-weight:600;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:.1s;user-select:none;-webkit-user-select:none;touch-action:manipulation;box-shadow:0 2px 4px rgba(0,0,0,.3),inset 0 1px 0 rgba(255,255,255,.8),inset 0 -1px 0 rgba(0,0,0,.1);position:relative;overflow:hidden}.keyboard-key::before{content:'';position:absolute;top:0;left:0;right:0;bottom:0;background:linear-gradient(to bottom,rgba(255,255,255,.3) 0,transparent 50%);pointer-events:none;border-radius:8px}.keyboard-key:hover{background:linear-gradient(to bottom,#f5f5f5 0,#d8d8d8 100%);transform:translateY(-1px);box-shadow:0 3px 6px rgba(0,0,0,.4),inset 0 1px 0 rgba(255,255,255,.9),inset 0 -1px 0 rgba(0,0,0,.1)}.keyboard-key.pressed,.keyboard-key:active{transform:translateY(1px) scale(.98);background:linear-gradient(to bottom,#d8d8d8 0,silver 100%);box-shadow:0 1px 2px rgba(0,0,0,.3),inset 0 2px 4px rgba(0,0,0,.2)}.keyboard-key.close-btn{background:linear-gradient(to bottom,#ff3b30 0,#d32f2f 100%);color:#fff;box-shadow:0 2px 4px rgba(0,0,0,.3),inset 0 1px 0 rgba(255,255,255,.3),inset 0 -1px 0 rgba(0,0,0,.2)}.keyboard-key.close-btn:hover{background:linear-gradient(to bottom,#ff5757 0,#e53935 100%);transform:translateY(-1px);box-shadow:0 3px 6px rgba(0,0,0,.4),inset 0 1px 0 rgba(255,255,255,.4),inset 0 -1px 0 rgba(0,0,0,.2)}.keyboard-key.close-btn:active{background:linear-gradient(to bottom,#d32f2f 0,#b71c1c 100%);transform:translateY(1px) scale(.98);box-shadow:0 1px 2px rgba(0,0,0,.3),inset 0 2px 4px rgba(0,0,0,.3)}.keyboard-toggle-btn{position:fixed;bottom:20px;right:20px;width:56px;height:56px;background:linear-gradient(to bottom,#f7bd36 0,#d4a12a 100%);color:#000;border:2px solid rgba(0,0,0,.2);border-radius:50%;font-size:26px;cursor:pointer;display:none;align-items:center;justify-content:center;z-index:9999;box-shadow:0 4px 12px rgba(0,0,0,.4),inset 0 1px 0 rgba(255,255,255,.3),inset 0 -1px 0 rgba(0,0,0,.1);transition:.3s;user-select:none;-webkit-user-select:none;touch-action:manipulation}.keyboard-toggle-btn:hover{background:linear-gradient(to bottom,#d4a12a 0,#b89224 100%);transform:scale(1.05);box-shadow:0 6px 16px rgba(0,0,0,.5),inset 0 1px 0 rgba(255,255,255,.4),inset 0 -1px 0 rgba(0,0,0,.1)}.keyboard-toggle-btn:active{transform:scale(.95);box-shadow:0 2px 6px rgba(0,0,0,.3),inset 0 2px 4px rgba(0,0,0,.2)}.keyboard-toggle-btn.active{display:flex}.keyboard-toggle-btn::before{content:'‚å®Ô∏è';filter:drop-shadow(0 1px 2px rgba(0, 0, 0, .3))}</style><div class="virtual-keyboard-wrapper"><div class="virtual-keyboard" id="virtualKeyboard"><div class="keyboard-container"><div class="keyboard-left" id="keyboardLeft"></div><div class="keyboard-right" id="keyboardRight"></div><button class="keyboard-close-btn" id="keyboardCloseBtn">‚úï</button></div></div></div><button class="keyboard-toggle-btn" id="keyboardToggleBtn"></button></body></html>